<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="it" data-bs-theme="auto">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Introduction to High-Performance Computing: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="../assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="../assets/styles.css">
<script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../favicons/cp/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicons/cp/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../favicons/cp/favicon-16x16.png">
<link rel="manifest" href="../favicons/cp/site.webmanifest">
<link rel="mask-icon" href="../favicons/cp/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="white">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="black">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md top-nav carpentries"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="cp-logo" alt="Lesson Description" src="../assets/images/carpentries-logo.svg"><span class="badge text-bg-warning">
          <abbr title="This lesson is in the alpha phase, which means that it has been taught once and lesson authors are iterating on feedback.">
            <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#field-testing-alpha-stage" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-triangle" style="border-radius: 5px"></i>
              Alpha
            </a>
            <span class="visually-hidden">This lesson is in the alpha phase, which means that it has been taught once and lesson authors are iterating on feedback.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
<li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul>
</li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='../aio.html';">Learner View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav carpentries" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Lesson Description" src="../assets/images/carpentries-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      Introduction to High-Performance Computing
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            Introduction to High-Performance Computing
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
<li><a class="dropdown-item" href="learner-prerequisites.html">Learner Prerequisites</a></li>
<li><a class="dropdown-item" href="learner-profiles.html">Learner Profiles</a></li>
<hr>
<li><a class="dropdown-item" href="discuss.html">Taking Your Next Steps</a></li>
<li><a class="dropdown-item" href="reference.html">Knowledge Base</a></li>
          </ul>
</li>
      </ul>
</div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="../instructor/aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Introduction to High-Performance Computing
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress carpentries">
    <div class="progress-bar carpentries" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text">
<li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul>
</li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../aio.html">Learner View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->

            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="10-hpc-intro.html">1. Perché usare un cluster?</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="11-connecting.html">2. Connessione a un sistema HPC remoto</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="12-cluster.html">3. Lavorare su un sistema HPC remoto</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="13-scheduler.html">4. Fondamenti di scheduler</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="14-environment-variables.html">5. Variabili d'ambiente</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="15-modules.html">6. Accesso al software tramite moduli</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="16-transferring-files.html">7. Trasferimento di file con computer remoti</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="17-parallel.html">8. Esecuzione di un lavoro parallelo</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush10">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading10">
        <a href="18-resources.html">9. Usare le risorse in modo efficace</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush11">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading11">
        <a href="19-responsibility.html">10. Usare le risorse condivise in modo responsabile</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      <li><a href="learner-prerequisites.html">Learner Prerequisites</a></li>
<li><a href="learner-profiles.html">Learner Profiles</a></li>
<hr>
<li><a class="dropdown-item" href="discuss.html">Taking Your Next Steps</a></li>
<li><a class="dropdown-item" href="reference.html">Knowledge Base</a></li>
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources">
<a href="../instructor/aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">

            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-10-hpc-intro"><p>Content from <a href="10-hpc-intro.html">Perché usare un cluster?</a></p>
<hr>
<p>Last updated on 2025-03-23 |

        <a href="https://github.com/ocaisa/probable-pancake/edit/main/episodes/10-hpc-intro.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 20 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>Perché dovrei essere interessato al calcolo ad alte prestazioni
(HPC)?</li>
<li>Cosa posso aspettarmi di imparare da questo corso?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Descrivere che cos’è un sistema HPC</li>
<li>Identificare i vantaggi di un sistema HPC.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Spesso i problemi di ricerca che utilizzano l’informatica possono
superare le capacità del computer desktop o portatile da cui sono
partiti:</p>
<ul>
<li>Uno studente di statistica vuole effettuare una convalida incrociata
di un modello. Ciò comporta l’esecuzione del modello 1000 volte, ma ogni
esecuzione richiede un’ora. L’esecuzione del modello su un computer
portatile richiede più di un mese! In questo problema di ricerca, i
risultati finali vengono calcolati dopo l’esecuzione di tutti i 1000
modelli, ma in genere viene eseguito solo un modello alla volta (in
<strong>serie</strong>) sul portatile. Poiché ognuna delle 1000
esecuzioni è indipendente da tutte le altre, e con un numero sufficiente
di computer, è teoricamente possibile eseguirle tutte insieme (in
<strong>parallelo</strong>).</li>
<li>Un ricercatore di genomica ha utilizzato piccoli insiemi di dati di
sequenza, ma presto riceverà un nuovo tipo di dati di sequenziamento 10
volte più grandi. Aprire i set di dati su un computer è già impegnativo,
analizzare questi set di dati più grandi probabilmente lo manderà in
tilt. In questo problema di ricerca, i calcoli richiesti potrebbero
essere impossibili da parallelizzare, ma sarebbe necessario un computer
con <strong>più memoria</strong> per analizzare i futuri set di dati
molto più grandi.</li>
<li>Un ingegnere sta usando un pacchetto di fluidodinamica che ha
un’opzione per l’esecuzione in parallelo. Finora questa opzione non è
stata utilizzata su un desktop. Passando dalle simulazioni 2D a quelle
3D, il tempo di simulazione è più che triplicato. Potrebbe essere utile
sfruttare questa opzione o funzione. In questo problema di ricerca, i
calcoli in ogni regione della simulazione sono ampiamente indipendenti
dai calcoli in altre regioni della simulazione. È possibile eseguire i
calcoli di ogni regione simultaneamente (in <strong>parallelo</strong>),
comunicare i risultati selezionati alle regioni adiacenti, se
necessario, e ripetere i calcoli per convergere su un insieme finale di
risultati. Passando da un modello 2D a uno 3D, <strong>la quantità di
dati e di calcoli aumenta notevolmente</strong>, ed è teoricamente
possibile distribuire i calcoli su più computer che comunicano su una
rete condivisa.</li>
</ul>
<p>In tutti questi casi, è necessario l’accesso a più computer (e più
grandi). Questi computer dovrebbero essere utilizzabili
contemporaneamente, <strong>risolvendo in parallelo i problemi di molti
ricercatori</strong>.</p>
<section><h2 class="section-heading" id="presentazione-del-gergo">Presentazione del gergo<a class="anchor" aria-label="anchor" href="#presentazione-del-gergo"></a>
</h2>
<hr class="half-width">
<p>Aprire <a href="../files/jargon#p1">HPC Jargon Buster</a> in una nuova
scheda. Per presentare il contenuto, premere <code>C</code> per aprire
una <strong>c</strong>lone in una finestra separata, quindi premere
<code>P</code> per attivare la modalità di
<strong>p</strong>resentazione.</p>
<div id="non-ho-mai-usato-un-server-vero" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="non-ho-mai-usato-un-server-vero" class="callout-inner">
<h3 class="callout-title">Non ho mai usato un server, vero?</h3>
<div class="callout-content">
<p>Prendete un minuto e pensate a quali delle vostre interazioni
quotidiane con un computer potrebbero richiedere un server remoto o
addirittura un cluster per fornirvi i risultati.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Alcune idee
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<ul>
<li>Controllo della posta elettronica: il vostro computer (magari in
tasca) contatta una macchina remota, si autentica e scarica un elenco di
nuovi messaggi; carica anche le modifiche allo stato dei messaggi, come
ad esempio se sono stati letti, contrassegnati come spazzatura o
cancellati. Poiché il vostro non è l’unico account, il server di posta è
probabilmente uno dei tanti in un centro dati.</li>
<li>La ricerca di una frase online comporta il confronto del termine di
ricerca con un enorme database di tutti i siti conosciuti, alla ricerca
di corrispondenze. Questa operazione di “interrogazione” può essere
semplice, ma la costruzione del database è un <a href="https://en.wikipedia.org/wiki/MapReduce" class="external-link">compito monumentale</a>!
I server sono coinvolti in ogni fase.</li>
<li>La ricerca di indicazioni stradali su un sito web di mappatura
comporta il collegamento dei punti (A) di partenza e (B) di arrivo <a href="https://en.wikipedia.org/wiki/Dijkstra%27s_algorithm" class="external-link">attraversando
un grafo</a> alla ricerca del percorso “più breve” in base alla
distanza, al tempo, alla spesa o a un’altra metrica. Convertire una
mappa nella forma corretta è relativamente semplice, ma calcolare tutti
i possibili percorsi tra A e B è costoso.</li>
</ul>
<p>Il controllo della posta elettronica potrebbe essere seriale: la
macchina si connette a un server e scambia dati. Anche la ricerca,
interrogando il database per il termine di ricerca (o gli endpoint),
potrebbe essere seriale, in quanto una macchina riceve l’interrogazione
e restituisce il risultato. Tuttavia, l’assemblaggio e la memorizzazione
dell’intero database vanno ben oltre le capacità di una sola macchina.
Pertanto, queste funzioni vengono svolte in parallelo da una vasta
collezione di server <a href="https://en.wikipedia.org/wiki/Hyperscale_computing" class="external-link">“hyperscale”</a>
che lavorano insieme.</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Il calcolo ad alte prestazioni (HPC) comporta tipicamente la
connessione a sistemi di calcolo molto grandi in altre parti del
mondo.</li>
<li>Questi altri sistemi possono essere utilizzati per eseguire lavori
che sarebbero impossibili o molto più lenti su sistemi più piccoli.</li>
<li>Le risorse HPC sono condivise da più utenti.</li>
<li>Il metodo standard di interazione con questi sistemi è tramite
un’interfaccia a riga di comando.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-11-connecting"><p>Content from <a href="11-connecting.html">Connessione a un sistema HPC remoto</a></p>
<hr>
<p>Last updated on 2025-03-23 |

        <a href="https://github.com/ocaisa/probable-pancake/edit/main/episodes/11-connecting.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 35 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>Come si accede a un sistema HPC remoto?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Configurare l’accesso sicuro a un sistema HPC remoto.</li>
<li>Connessione a un sistema HPC remoto.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="connessioni-sicure">Connessioni sicure<a class="anchor" aria-label="anchor" href="#connessioni-sicure"></a>
</h2>
<hr class="half-width">
<p>Il primo passo per utilizzare un cluster è stabilire una connessione
dal nostro portatile al cluster. Quando siamo seduti davanti a un
computer (o in piedi, o tenendolo in mano o al polso), ci aspettiamo una
visualizzazione con icone, widget e forse alcune finestre o
applicazioni: una <em>interfaccia utente grafica</em>, o GUI. Poiché i
cluster di computer sono risorse remote a cui ci si connette tramite
interfacce lente o intermittenti (soprattutto WiFi e VPN), è più pratico
utilizzare una <em>interfaccia a riga di comando</em>, o CLI, per
inviare comandi in testo semplice. Se un comando restituisce un output,
anche questo viene stampato come testo normale. I comandi che eseguiamo
oggi non apriranno una finestra per mostrare i risultati grafici.</p>
<p>Se avete mai aperto il Prompt dei comandi di Windows o il Terminale
di macOS, avete visto una CLI. Se avete già seguito i corsi di The
Carpentries sulla shell UNIX o sul controllo di versione, avete usato
ampiamente la CLI sulla vostra macchina <em>locale</em>. L’unico salto
da fare in questo caso è aprire una CLI su una <em>macchina remota</em>,
prendendo alcune precauzioni in modo che gli altri utenti della rete non
possano vedere (o modificare) i comandi che state eseguendo o i
risultati che la macchina remota invia. Utilizzeremo il protocollo
Secure SHell (o SSH) per aprire una connessione di rete crittografata
tra due macchine, consentendovi di inviare e ricevere testo e dati senza
dovervi preoccupare di occhi indiscreti.</p>
<figure><img src="../fig/connect-to-remote.svg" max-width="50%" alt="Connetti al cluster" class="figure mx-auto d-block"></figure><p>I client SSH sono solitamente strumenti a riga di comando, in cui si
fornisce l’indirizzo della macchina remota come unico argomento
richiesto. Se il nome utente sul sistema remoto è diverso da quello
utilizzato localmente, è necessario fornire anche quello. Se il vostro
client SSH ha un front-end grafico, come PuTTY o MobaXterm, dovrete
impostare questi argomenti prima di fare clic su “connect” Dal
terminale, si scriverà qualcosa come <code>ssh userName@hostname</code>,
dove l’argomento è proprio come un indirizzo e-mail: il simbolo “@” è
usato per separare l’ID personale dall’indirizzo della macchina
remota.</p>
<p>Quando si accede a un computer portatile, a un tablet o a un altro
dispositivo personale, di solito sono necessari un nome utente, una
password o un modello per impedire l’accesso non autorizzato. In queste
situazioni, la probabilità che qualcun altro intercetti la password è
bassa, poiché la registrazione dei tasti premuti richiede un exploit
dannoso o un accesso fisico. Per i sistemi come login1’ che eseguono un
server SSH, chiunque sulla rete può accedere, o tentare di farlo. Poiché
i nomi utente sono spesso pubblici o facili da indovinare, la password è
spesso l’anello più debole della catena di sicurezza. Per questo motivo,
molti cluster vietano il login basato su password, richiedendo invece di
generare e configurare una coppia di chiavi pubbliche e private con una
password molto più forte. Anche se il vostro cluster non lo richiede, la
prossima sezione vi guiderà nell’uso delle chiavi SSH e di un agente SSH
per rafforzare la vostra sicurezza <em>e</em> rendere più conveniente
l’accesso ai sistemi remoti.</p>
<div class="section level3">
<h3 id="migliore-sicurezza-con-le-chiavi-ssh">Migliore sicurezza con le chiavi SSH<a class="anchor" aria-label="anchor" href="#migliore-sicurezza-con-le-chiavi-ssh"></a>
</h3>
<p>Il <a href="index.html#setup">Lesson Setup</a> fornisce le istruzioni per
installare un’applicazione shell con SSH. Se non l’avete già fatto,
aprite l’applicazione di shell con un’interfaccia a riga di comando di
tipo Unix sul vostro sistema.</p>
<p>Le chiavi SSH sono un metodo alternativo di autenticazione per
ottenere l’accesso a sistemi informatici remoti. Possono anche essere
usate per l’autenticazione durante il trasferimento di file o per
accedere a sistemi di controllo di versione remoti (come <a href="https://docs.github.com/en/authentication/connecting-to-github-with-ssh" class="external-link">GitHub</a>).
In questa sezione verrà creata una coppia di chiavi SSH:</p>
<ul>
<li>una chiave privata che si conserva sul proprio computer e</li>
<li>una chiave pubblica che può essere inserita in qualsiasi sistema
remoto a cui si accede.</li>
</ul>
<div id="le-chiavi-private-sono-il-vostro-passaporto-digitale-sicuro" class="callout caution">
<div class="callout-square">
<i class="callout-icon" data-feather="alert-triangle"></i>
</div>
<div id="le-chiavi-private-sono-il-vostro-passaporto-digitale-sicuro" class="callout-inner">
<h3 class="callout-title">Le chiavi private sono il vostro passaporto digitale sicuro</h3>
<div class="callout-content">
<p>Una chiave privata visibile a chiunque tranne che a voi deve essere
considerata compromessa e deve essere distrutta. Questo include avere
permessi impropri sulla directory in cui è memorizzata (o una sua
copia), attraversare una rete non sicura (crittografata), allegare
e-mail non crittografate e persino visualizzare la chiave nella finestra
del terminale.</p>
<p>Proteggete questa chiave come se vi aprisse la porta di casa. Per
molti versi, è così.</p>
</div>
</div>
</div>
<p>Indipendentemente dal software o dal sistema operativo utilizzato,
<em>prego</em> di scegliere una password o una passphrase forte che
funga da ulteriore livello di protezione per la chiave SSH privata.</p>
<div id="considerazioni-sulle-password-delle-chiavi-ssh" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="considerazioni-sulle-password-delle-chiavi-ssh" class="callout-inner">
<h3 class="callout-title">Considerazioni sulle password delle chiavi SSH</h3>
<div class="callout-content">
<p>Quando viene richiesto, inserire una password forte che si ricordi.
Esistono due approcci comuni:</p>
<ol style="list-style-type: decimal">
<li>Creare una passphrase memorabile con punteggiatura e sostituzioni di
numeri con lettere, di almeno 32 caratteri. Gli indirizzi stradali
funzionano bene; fate attenzione agli attacchi di social engineering o
ai registri pubblici.</li>
<li>Utilizzare un gestore di password e il suo generatore di password
integrato con tutte le classi di caratteri, a partire da 25 caratteri.
<a href="https://keepass.info" class="external-link">KeePass</a> e <a href="https://bitwarden.com" class="external-link">BitWarden</a> sono due buone opzioni.</li>
<li>Nulla è <em>meno</em> sicuro di una chiave privata senza password.
Se per sbaglio avete saltato l’inserimento della password, tornate
indietro e generate una nuova coppia di chiavi <em>con</em> una password
forte.</li>
</ol>
</div>
</div>
</div>
<div class="section level4">
<h4 id="chiavi-ssh-su-linux-mac-mobaxterm-e-windows-sottosistema-per-linux">Chiavi SSH su Linux, Mac, MobaXterm e Windows Sottosistema per
Linux<a class="anchor" aria-label="anchor" href="#chiavi-ssh-su-linux-mac-mobaxterm-e-windows-sottosistema-per-linux"></a>
</h4>
<p>Una volta aperto il terminale, verificare la presenza di chiavi SSH e
nomi di file esistenti, poiché le chiavi SSH esistenti vengono
sovrascritte.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> ls ~/.ssh/</span></code></pre>
</div>
<p>se <code>~/.ssh/id_ed25519</code> esiste già, è necessario
specificare un nome diverso per la nuova coppia di chiavi.</p>
<p>Generare una nuova coppia di chiavi pubbliche e private usando il
seguente comando, che produrrà una chiave più forte di quella
predefinita <code>ssh-keygen</code> invocando questi flag:</p>
<ul>
<li>
<code>-a</code> (il valore predefinito è 16): numero di cicli di
derivazione della passphrase; aumentare per rallentare gli attacchi
brute force.</li>
<li>
<code>-t</code> (l’impostazione predefinita è <a href="https://en.wikipedia.org/wiki/RSA_(cryptosystem)" class="external-link">rsa</a>):
specifica il “tipo” o algoritmo crittografico.<code>ed25519</code>
specifica <a href="https://en.wikipedia.org/wiki/EdDSA" class="external-link">EdDSA</a> con
una chiave a 256 bit; è più veloce di RSA con una forza
comparabile.</li>
<li>
<code>-f</code> (predefinito è /home/user/.ssh/id): nome del file in
cui memorizzare la chiave privata. Il nome del file della chiave
pubblica sarà identico, con l’aggiunta dell’estensione
<code>.pub</code>.</li>
</ul>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> ssh-keygen <span class="at">-a</span> 100 <span class="at">-f</span> ~/.ssh/id_ed25519 <span class="at">-t</span> ed25519</span></code></pre>
</div>
<p>Quando viene richiesto, inserire una password forte tenendo conto
delle <a href="#considerazioni-per-le-chiavi-password">considerazioni
precedenti</a>. Si noti che il terminale non sembra cambiare mentre si
digita la password: questo è intenzionale, per la vostra sicurezza. Vi
verrà richiesto di digitarla di nuovo, quindi non preoccupatevi troppo
degli errori di battitura.</p>
<p>Guardare in <code>~/.ssh</code> (usare <code>ls ~/.ssh</code>). Si
dovrebbero vedere due nuovi file:</p>
<ul>
<li>la vostra chiave privata (<code>~/.ssh/id_ed25519</code>): *non
condividere con nessuno!</li>
<li>la chiave pubblica condivisibile
(<code>~/.ssh/id_ed25519.pub</code>): se un amministratore di sistema
chiede una chiave, questa è quella da inviare. È anche sicura da
caricare su siti web come GitHub: è destinata a essere vista.</li>
</ul>
<div id="usa-rsa-per-i-sistemi-più-vecchi" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="usa-rsa-per-i-sistemi-più-vecchi" class="callout-inner">
<h3 class="callout-title">Usa RSA per i sistemi più vecchi</h3>
<div class="callout-content">
<p>Se la generazione della chiave non è riuscita perché ed25519 non è
disponibile, provare a usare il più vecchio (ma ancora forte e
affidabile) crittosistema <a href="https://en.wikipedia.org/wiki/RSA_(cryptosystem)" class="external-link">RSA</a>. Anche
in questo caso, verificare prima la presenza di una chiave
esistente:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> ls ~/.ssh/</span></code></pre>
</div>
<p>Se <code>~/.ssh/id_rsa</code> esiste già, è necessario specificare un
nome diverso per la nuova coppia di chiavi. Generarla come sopra, con i
seguenti flag aggiuntivi:</p>
<ul>
<li>
<code>-b</code> imposta il numero di bit della chiave.
L’impostazione predefinita è 2048. EdDSA utilizza una lunghezza fissa
della chiave, quindi questo flag non ha alcun effetto.</li>
<li>
<code>-o</code> (nessun valore predefinito): utilizzare il formato
della chiave OpenSSH, anziché PEM.</li>
</ul>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> ssh-keygen <span class="at">-a</span> 100 <span class="at">-b</span> 4096 <span class="at">-f</span> ~/.ssh/id_rsa <span class="at">-o</span> <span class="at">-t</span> rsa</span></code></pre>
</div>
<p>Quando viene richiesto, inserire una password forte tenendo conto
delle <a href="#considerazioni-per-le-chiavi-password">considerazioni di
cui sopra</a>.</p>
<p>Guardare in <code>~/.ssh</code> (usare <code>ls ~/.ssh</code>). Si
dovrebbero vedere due nuovi file:</p>
<ul>
<li>la vostra chiave privata (<code>~/.ssh/id_rsa</code>): *non
condividere con nessuno!</li>
<li>la chiave pubblica condivisibile (<code>~/.ssh/id_rsa.pub</code>):
se un amministratore di sistema chiede una chiave, questa è quella da
inviare. È anche sicura da caricare su siti web come GitHub: è destinata
a essere vista.</li>
</ul>
</div>
</div>
</div>
</div>
<div class="section level4">
<h4 id="chiavi-ssh-su-putty">Chiavi SSH su PuTTY<a class="anchor" aria-label="anchor" href="#chiavi-ssh-su-putty"></a>
</h4>
<p>Se si usa PuTTY su Windows, scaricare e usare <code>puttygen</code>
per generare la coppia di chiavi. Vedere la <a href="https://tartarus.org/~simon/putty-prerel-snapshots/htmldoc/Chapter8.html#pubkey-puttygen" class="external-link">documentazione
di PuTTY</a> per i dettagli.</p>
<ul>
<li>Selezionare <code>EdDSA</code> come tipo di chiave.</li>
<li>Selezionare <code>255</code> come dimensione o forza della
chiave.</li>
<li>Fare clic sul pulsante “Genera”.</li>
<li>Non è necessario inserire un commento.</li>
<li>Quando viene richiesto, inserire una password forte tenendo conto
delle <a href="#considerazioni-per-le-chiavi-password">considerazioni di
cui sopra</a>.</li>
<li>Salvare le chiavi in una cartella che non può essere letta da altri
utenti del sistema.</li>
</ul>
<p>Guardare nella cartella specificata. Si dovrebbero vedere due nuovi
file:</p>
<ul>
<li>la vostra chiave privata (<code>id_ed25519</code>): *non condividere
con nessuno!</li>
<li>la chiave pubblica condivisibile (<code>id_ed25519.pub</code>): se
un amministratore di sistema chiede una chiave, questa è quella da
inviare. È anche sicura da caricare su siti web come GitHub: è destinata
a essere vista.</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="agente-ssh-per-una-gestione-delle-chiavi-più-semplice">Agente SSH per una gestione delle chiavi più semplice<a class="anchor" aria-label="anchor" href="#agente-ssh-per-una-gestione-delle-chiavi-pi%C3%B9-semplice"></a>
</h3>
<p>Una chiave SSH è forte quanto la password usata per sbloccarla, ma
d’altra parte digitare una password complessa ogni volta che ci si
connette a una macchina è noioso e stufa molto velocemente. È qui che
entra in gioco l’<a href="https://www.ssh.com/academy/ssh/agent" class="external-link">agente
SSH</a>.</p>
<p>Utilizzando un agente SSH, è possibile digitare una volta la password
per la chiave privata e fare in modo che l’agente la ricordi per un
certo numero di ore o finché non ci si disconnette. A meno che qualche
malintenzionato non abbia accesso fisico al vostro computer, questo
permette di mantenere la password al sicuro ed elimina la noia di
doverla digitare più volte.</p>
<p>Ricordate la password, perché una volta scaduta nell’Agente, dovrete
digitarla di nuovo.</p>
<div class="section level4">
<h4 id="agenti-ssh-su-linux-macos-e-windows">Agenti SSH su Linux, macOS e Windows<a class="anchor" aria-label="anchor" href="#agenti-ssh-su-linux-macos-e-windows"></a>
</h4>
<p>Aprire l’applicazione terminale e verificare se è in esecuzione un
agente:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> ssh-add <span class="at">-l</span></span></code></pre>
</div>
<ul>
<li>
<p>Se si ottiene un errore come questo,</p>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error connecting to agent: No such file or directory</code></pre>
</div>
<p>… quindi è necessario lanciare l’agente come segue:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> eval <span class="va">$(</span><span class="fu">ssh-agent</span><span class="va">)</span></span></code></pre>
</div>
<div id="callout3" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Cosa c’è in un
<code>$(...)</code>?</h3>
<div class="callout-content">
<p>La sintassi di questo comando dell’agente SSH è insolita, rispetto a
quanto visto nella lezione sulla shell UNIX. Questo perché il comando
<code>ssh-agent</code> crea una connessione a cui solo voi avete accesso
e stampa una serie di comandi di shell che possono essere usati per
raggiungerla, ma *non li esegue!</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> ssh-agent</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>SSH_AUTH_SOCK=/tmp/ssh-Zvvga2Y8kQZN/agent.131521;
export SSH_AUTH_SOCK;
SSH_AGENT_PID=131522;
export SSH_AGENT_PID;
echo Agent pid 131522;</code></pre>
</div>
<p>Il comando <code>eval</code> interpreta l’output di testo come
comandi e consente di accedere alla connessione dell’agente SSH appena
creata.</p>
<p>Si potrebbe eseguire da soli ogni riga dell’output di
<code>ssh-agent</code> e ottenere lo stesso risultato. L’uso di
<code>eval</code> rende tutto più semplice.</p>
</div>
</div>
</div>
</li>
<li><p>In caso contrario, l’agente è già in esecuzione: non
modificarlo.</p></li>
</ul>
<p>Aggiungere la propria chiave all’agente, con scadenza della sessione
dopo 8 ore:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> ssh-add <span class="at">-t</span> 8h ~/.ssh/id_ed25519</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Enter passphrase for .ssh/id_ed25519:
Identity added: .ssh/id_ed25519
Lifetime set to 86400 seconds</code></pre>
</div>
<p>Per tutta la durata (8 ore), ogni volta che userete quella chiave,
l’agente SSH fornirà la chiave per vostro conto senza che dobbiate
digitare un solo tasto.</p>
</div>
<div class="section level4">
<h4 id="agente-ssh-su-putty">Agente SSH su PuTTY<a class="anchor" aria-label="anchor" href="#agente-ssh-su-putty"></a>
</h4>
<p>Se si usa PuTTY su Windows, scaricare e usare <code>pageant</code>
come agente SSH. Vedere la <a href="https://tartarus.org/~simon/putty-prerel-snapshots/htmldoc/Chapter9.html#pageant" class="external-link">documentazione
di PuTTY</a>.</p>
</div>
</div>
<div class="section level3">
<h3 id="trasferire-la-propria-chiave-pubblica">Trasferire la propria chiave pubblica<a class="anchor" aria-label="anchor" href="#trasferire-la-propria-chiave-pubblica"></a>
</h3>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> scp ~/.ssh/id_ed25519.pub yourUsername@cluster.hpc-carpentry.org:~/</span></code></pre>
</div>
</div>
</section><section><h2 class="section-heading" id="accedere-al-cluster">Accedere al cluster<a class="anchor" aria-label="anchor" href="#accedere-al-cluster"></a>
</h2>
<hr class="half-width">
<p>Aprire il terminale o il client grafico SSH, quindi accedere al
cluster. Sostituire <code>yourUsername</code> con il proprio nome utente
o con quello fornito dagli istruttori.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> ssh yourUsername@cluster.hpc-carpentry.org</span></code></pre>
</div>
<p>potrebbe essere richiesta la password. Attenzione: i caratteri
digitati dopo la richiesta della password non vengono visualizzati sullo
schermo. L’output normale riprenderà quando si premerà
<code>Enter</code>.</p>
<p>avrete notato che il prompt è cambiato quando vi siete collegati al
sistema remoto usando il terminale (se vi siete collegati con PuTTY
questo non vale perché non offre un terminale locale). Questo
cambiamento è importante perché può aiutare a distinguere su quale
sistema verranno eseguiti i comandi digitati quando li si passa al
terminale. Questa modifica rappresenta anche una piccola complicazione
che dovremo affrontare nel corso del workshop. L’esatta visualizzazione
del prompt (che convenzionalmente termina con <code>$</code>) nel
terminale quando è collegato al sistema locale e al sistema remoto sarà
in genere diversa per ogni utente. È comunque necessario indicare su
quale sistema si stanno inserendo i comandi, quindi adotteremo la
seguente convenzione:</p>
<ul>
<li>
<code>[you@laptop:~]$</code> quando il comando deve essere immesso
su un terminale collegato al computer locale</li>
<li>
<code>[yourUsername@login1 ~]</code> quando il comando deve essere
immesso su un terminale collegato al sistema remoto</li>
<li>
<code>$</code> quando non ha importanza a quale sistema sia
collegato il terminale.</li>
</ul></section><section><h2 class="section-heading" id="guardando-intorno-alla-vostra-casa-remota">Guardando intorno alla vostra casa remota<a class="anchor" aria-label="anchor" href="#guardando-intorno-alla-vostra-casa-remota"></a>
</h2>
<hr class="half-width">
<p>Molto spesso, molti utenti sono tentati di pensare a un’installazione
di calcolo ad alte prestazioni come a una gigantesca macchina magica. A
volte si pensa che il computer a cui si accede sia l’intero cluster di
calcolo. Ma cosa sta succedendo davvero? A quale computer ci siamo
collegati? Il nome del computer correntemente collegato può essere
controllato con il comando <code>hostname</code>. (Si può anche notare
che il nome dell’host corrente fa parte del nostro prompt)</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] hostname</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">login1</span></span></code></pre>
</div>
<p>Quindi, siamo sicuramente sul computer remoto. Quindi, scopriamo dove
ci troviamo eseguendo <code>pwd</code> per <strong>stampare la
</strong>cartella di lavoro <strong>d</strong>.</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] pwd</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>/home/yourUsername</code></pre>
</div>
<p>Ottimo, sappiamo dove siamo! Vediamo cosa c’è nella nostra directory
corrente:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] ls</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">id_ed25519.pub</span></span></code></pre>
</div>
<p>Gli amministratori del sistema potrebbero aver configurato la vostra
home directory con alcuni file, cartelle e collegamenti (scorciatoie)
utili allo spazio riservato a voi su altri filesystem. Se non l’hanno
fatto, la home directory potrebbe apparire vuota. Per ricontrollare,
includere i file nascosti nell’elenco delle directory:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] ls <span class="at">-a</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  .            .bashrc           id_ed25519.pub
  ..           .ssh</code></pre>
</div>
<p>Nella prima colonna, <code>.</code> è un riferimento alla directory
corrente e <code>..</code> un riferimento al suo genitore
(<code>/home</code>). Gli altri file, o file simili, possono essere
visualizzati o meno: <code>.bashrc</code> è un file di configurazione
della shell, che può essere modificato con le proprie preferenze; e
<code>.ssh</code> è una directory che memorizza le chiavi SSH e un
registro delle connessioni autorizzate.</p>
<div class="section level3">
<h3 id="installare-la-chiave-ssh">Installare la chiave SSH<a class="anchor" aria-label="anchor" href="#installare-la-chiave-ssh"></a>
</h3>
<div id="ci-può-essere-un-modo-migliore" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ci-può-essere-un-modo-migliore" class="callout-inner">
<h3 class="callout-title">Ci può essere un modo migliore</h3>
<div class="callout-content">
<p>Le politiche e le pratiche per la gestione delle chiavi SSH variano
tra i cluster HPC: seguire le indicazioni fornite dagli amministratori
del cluster o la documentazione. In particolare, se esiste un portale
online per la gestione delle chiavi SSH, utilizzare quello invece delle
indicazioni qui riportate.</p>
</div>
</div>
</div>
<p>Se si è trasferita la chiave pubblica SSH con <code>scp</code>, si
dovrebbe vedere <code>id_ed25519.pub</code> nella propria home
directory. Per “installare” questa chiave, deve essere elencata in un
file chiamato <code>authorized_keys</code> sotto la cartella
<code>.ssh</code>.</p>
<p>Se la cartella <code>.ssh</code> non è stata elencata sopra, allora
non esiste ancora: crearla.</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] mkdir ~/.ssh</span></code></pre>
</div>
<p>Ora, usare <code>cat</code> per stampare la chiave pubblica, ma
reindirizzare l’output, aggiungendolo al file
<code>authorized_keys</code>:</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] cat ~/id_ed25519.pub <span class="op">&gt;&gt;</span> ~/.ssh/authorized_keys</span></code></pre>
</div>
<p>Tutto qui! Se la chiave e l’agente sono stati configurati
correttamente, non dovrebbe essere richiesta la password per la chiave
SSH.</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] logout</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> ssh yourUsername@cluster.hpc-carpentry.org</span></code></pre>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Un sistema HPC è un insieme di macchine collegate in rete.</li>
<li>I sistemi HPC forniscono in genere nodi di accesso e una serie di
nodi worker.</li>
<li>Le risorse presenti sui nodi indipendenti (worker) possono variare
per volume e tipo (quantità di RAM, architettura del processore,
disponibilità di filesystem montati in rete, ecc.)</li>
<li>I file salvati su un nodo sono disponibili su tutti i nodi.</li>
</ul>
</div>
</div>
</div>
</div>
</section></section><section id="aio-12-cluster"><p>Content from <a href="12-cluster.html">Lavorare su un sistema HPC remoto</a></p>
<hr>
<p>Last updated on 2025-03-23 |

        <a href="https://github.com/ocaisa/probable-pancake/edit/main/episodes/12-cluster.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 35 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>“Che cos’è un sistema HPC?”</li>
<li>“Come funziona un sistema HPC?”</li>
<li>“Come si accede a un sistema HPC remoto?”</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>“Connettersi a un sistema HPC remoto”</li>
<li>“Comprendere l’architettura generale del sistema HPC”</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="cosè-un-sistema-hpc">Cos’è un sistema HPC?<a class="anchor" aria-label="anchor" href="#cos%C3%A8-un-sistema-hpc"></a>
</h2>
<hr class="half-width">
<p>Le parole “cloud”, “cluster” e l’espressione “calcolo ad alte
prestazioni” o “HPC” sono molto usate in contesti diversi e con vari
significati correlati. Che cosa significano? E soprattutto, come li
usiamo nel nostro lavoro?</p>
<p>Il <em>cloud</em> è un termine generico comunemente usato per
riferirsi a risorse informatiche che sono a) <em>fornite</em> agli
utenti su richiesta o in base alle necessità e b) rappresentano risorse
reali o <em>virtuali</em> che possono essere situate ovunque sulla
Terra. Ad esempio, una grande azienda con risorse informatiche in
Brasile, Zimbabwe e Giappone può gestire tali risorse come un proprio
cloud <em>interno</em> e la stessa azienda può anche utilizzare risorse
cloud commerciali fornite da Amazon o Google. Le risorse cloud possono
riferirsi a macchine che eseguono compiti relativamente semplici come
servire siti web, fornire storage condiviso, fornire servizi web (come
e-mail o piattaforme di social media), così come compiti più
tradizionali ad alta intensità di calcolo come l’esecuzione di una
simulazione.</p>
<p>Il termine <em>sistema HPC</em>, invece, descrive una risorsa
indipendente per carichi di lavoro ad alta intensità di calcolo. In
genere sono costituiti da una moltitudine di elementi integrati di
elaborazione e archiviazione, progettati per gestire elevati volumi di
dati e/o un gran numero di operazioni in virgola mobile (<a href="https://en.wikipedia.org/wiki/FLOPS" class="external-link">FLOPS</a>) con le massime
prestazioni possibili. Ad esempio, tutte le macchine presenti
nell’elenco <a href="https://www.top500.org" class="external-link">Top-500</a> sono sistemi
HPC. Per supportare questi vincoli, una risorsa HPC deve esistere in una
posizione specifica e fissa: i cavi di rete possono estendersi solo fino
a un certo punto e i segnali elettrici e ottici possono viaggiare solo a
una certa velocità.</p>
<p>La parola “cluster” è spesso usata per risorse HPC di scala piccola o
moderata, meno impressionanti della <a href="https://www.top500.org" class="external-link">Top-500</a>. I cluster sono spesso gestiti
in centri di calcolo che supportano diversi sistemi di questo tipo,
tutti accomunati dalla condivisione di reti e storage per supportare
attività comuni ad alta intensità di calcolo.</p>
</section><section><h2 class="section-heading" id="registrazione">Registrazione<a class="anchor" aria-label="anchor" href="#registrazione"></a>
</h2>
<hr class="half-width">
<p>Il primo passo per utilizzare un cluster è stabilire una connessione
dal nostro portatile al cluster. Quando siamo seduti al computer (o in
piedi, o tenendolo in mano o al polso), ci aspettiamo una
visualizzazione con icone, widget e forse alcune finestre o
applicazioni: un’interfaccia grafica utente, o GUI. Poiché i cluster di
computer sono risorse remote a cui ci colleghiamo tramite interfacce
spesso lente o laggose (soprattutto WiFi e VPN), è più pratico
utilizzare un’interfaccia a riga di comando (CLI), in cui i comandi e i
risultati sono trasmessi solo tramite testo. Tutto ciò che non è testo
(ad esempio le immagini) deve essere scritto su disco e aperto con un
programma separato.</p>
<p>Se avete mai aperto il Prompt dei comandi di Windows o il Terminale
di macOS, avete visto una CLI. Se avete già seguito i corsi di The
Carpentries sulla shell UNIX o sul controllo di versione, avete usato la
CLI sulla vostra macchina locale in modo piuttosto esteso. L’unico salto
da fare in questo caso è aprire una CLI su una macchina <em>remota</em>,
prendendo alcune precauzioni in modo che gli altri utenti della rete non
possano vedere (o modificare) i comandi che state eseguendo o i
risultati che la macchina remota invia. Utilizzeremo il protocollo
Secure SHell (o SSH) per aprire una connessione di rete crittografata
tra due macchine, consentendo di inviare e ricevere testo e dati senza
doversi preoccupare di occhi indiscreti.</p>
<figure><img src="../fig/connect-to-remote.svg" alt-text="Connetti al cluster" alt="Connetti al cluster" class="figure mx-auto d-block"><div class="figcaption">Connetti al cluster</div>
</figure><p>Assicurarsi di avere un client SSH installato sul portatile. Fare
riferimento alla sezione <a href="index.html">setup</a> per maggiori
dettagli. I client SSH sono solitamente strumenti a riga di comando, in
cui si fornisce l’indirizzo della macchina remota come unico argomento
richiesto. Se il nome utente sul sistema remoto è diverso da quello
utilizzato localmente, è necessario fornire anche quello. Se il vostro
client SSH ha un front-end grafico, come PuTTY o MobaXterm, dovrete
impostare questi argomenti prima di fare clic su “connect” Dal
terminale, si scriverà qualcosa come <code>ssh userName@hostname</code>,
dove il simbolo “@” è usato per separare le due parti di un singolo
argomento.</p>
<p>Aprite il vostro terminale o il vostro client grafico SSH, quindi
accedete al cluster usando il vostro nome utente e il computer remoto
che potete raggiungere dal mondo esterno, cluster.hpc-carpentry.org.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> ssh yourUsername@cluster.hpc-carpentry.org</span></code></pre>
</div>
<p>Ricordarsi di sostituire <code>yourUsername</code> con il proprio
nome utente o con quello fornito dagli istruttori. Potrebbe essere
richiesta la password. Attenzione: i caratteri digitati dopo la
richiesta della password non vengono visualizzati sullo schermo.
L’output normale riprenderà quando si premerà <code>Enter</code>.</p>
</section><section><h2 class="section-heading" id="dove-siamo">Dove siamo?<a class="anchor" aria-label="anchor" href="#dove-siamo"></a>
</h2>
<hr class="half-width">
<p>Molto spesso, molti utenti sono tentati di pensare a un’installazione
di calcolo ad alte prestazioni come a una gigantesca macchina magica. A
volte si pensa che il computer a cui si è acceduto sia l’intero cluster
di calcolo. Ma cosa sta succedendo davvero? A quale computer ci siamo
collegati? Il nome del computer correntemente collegato può essere
controllato con il comando <code>hostname</code>. (Si può anche notare
che il nome dell’host corrente fa parte del nostro prompt)</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] hostname</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">login1</span></span></code></pre>
</div>
<div id="cosa-cè-nella-vostra-directory-principale" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="cosa-cè-nella-vostra-directory-principale" class="callout-inner">
<h3 class="callout-title">Cosa c’è nella vostra directory principale?</h3>
<div class="callout-content">
<p>Gli amministratori del sistema potrebbero aver configurato la vostra
home directory con alcuni file, cartelle e collegamenti (scorciatoie)
utili allo spazio riservato a voi su altri filesystem. Date un’occhiata
in giro e vedete cosa riuscite a trovare. <em>Suggerimento:</em> I
comandi di shell <code>pwd</code> e <code>ls</code> possono essere
utili. Il contenuto della home directory varia da utente a utente.
Discutete con i vostri vicini le eventuali differenze riscontrate.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> È una bella giornata nel quartiere </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>Il livello più profondo dovrebbe essere diverso:
<code>yourUsername</code> è unicamente vostro. Ci sono differenze nel
percorso ai livelli superiori?</p>
<p>se entrambi avete delle directory vuote, appariranno identiche. Se
voi o il vostro vicino avete già usato il sistema, potrebbero esserci
delle differenze. Su cosa state lavorando?</p>
<p>Usare <code>pwd</code> per <strong>stampare il percorso della
</strong>d**irettoria di lavoro:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] pwd</span></code></pre>
</div>
<p>è possibile eseguire <code>ls</code> per verificare il contenuto
della directory, anche se è possibile che non venga visualizzato nulla
(se non sono stati forniti file). Per sicurezza, usare il flag
<code>-a</code> per mostrare anche i file nascosti.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] ls <span class="at">-a</span></span></code></pre>
</div>
<p>come minimo, mostrerà la directory corrente come <code>.</code> e la
directory padre come <code>..</code>.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="nodi">Nodi<a class="anchor" aria-label="anchor" href="#nodi"></a>
</h2>
<hr class="half-width">
<p>I singoli computer che compongono un cluster sono in genere chiamati
<em>nodi</em> (anche se si sente parlare anche di <em>server</em>,
<em>computer</em> e <em>macchine</em>). In un cluster, ci sono diversi
tipi di nodi per diversi tipi di attività. Il nodo in cui ci si trova in
questo momento è chiamato <em>nodo principale</em>, <em>nodo di
accesso</em>, <em>pista di atterraggio</em> o <em>nodo di invio</em>. Un
nodo di accesso serve come punto di accesso al cluster.</p>
<p>come gateway, è adatto per caricare e scaricare file, configurare
software ed eseguire test rapidi. In generale, il nodo di accesso non
dovrebbe essere usato per attività che richiedono molto tempo o risorse.
È necessario prestare attenzione a questo aspetto e verificare con i
gestori del sito o con la documentazione i dettagli di ciò che è
consentito o meno. In queste lezioni, eviteremo di eseguire lavori sul
nodo principale.</p>
<div id="nodi-di-trasferimento-dedicati" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="nodi-di-trasferimento-dedicati" class="callout-inner">
<h3 class="callout-title">Nodi di trasferimento dedicati</h3>
<div class="callout-content">
<p>Se si desidera trasferire grandi quantità di dati da o verso il
cluster, alcuni sistemi offrono nodi dedicati solo al trasferimento dei
dati. La motivazione risiede nel fatto che i trasferimenti di dati più
grandi non devono ostacolare il funzionamento del nodo di login per
nessun altro. Verificate con la documentazione del vostro cluster o con
il team di supporto se è disponibile un nodo di trasferimento di questo
tipo. Come regola generale, si considerano grandi tutti i trasferimenti
di un volume superiore a 500 MB e 1 GB. Ma questi numeri cambiano, ad
esempio, a seconda della connessione di rete propria e del cluster o di
altri fattori.</p>
</div>
</div>
</div>
<p>Il vero lavoro in un cluster viene svolto dai <em>nodi di lavoro</em>
(o di calcolo*). I nodi worker sono di varie forme e dimensioni, ma in
genere sono dedicati a compiti lunghi o difficili che richiedono molte
risorse di calcolo.</p>
<p>Tutte le interazioni con i nodi worker sono gestite da un software
specializzato chiamato scheduler (lo scheduler usato in questa lezione
si chiama <strong>Slurm</strong>). In seguito impareremo a usare lo
scheduler per inviare i lavori, ma per il momento è in grado di fornire
ulteriori informazioni sui nodi worker.</p>
<p>Per esempio, possiamo visualizzare tutti i nodi worker eseguendo il
comando <code>sinfo</code>.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] sinfo</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>PARTITION          AVAIL  TIMELIMIT  NODES  STATE NODELIST
cpubase_bycore_b1*    up   infinite      4   idle node[1-2],smnode[1-2]
node                  up   infinite      2   idle node[1-2]
smnode                up   infinite      2   idle smnode[1-2]</code></pre>
</div>
<p>Ci sono anche macchine specializzate utilizzate per gestire lo
storage del disco, l’autenticazione degli utenti e altri compiti legati
all’infrastruttura. Sebbene in genere non ci si colleghi o si
interagisca direttamente con queste macchine, esse consentono di
svolgere una serie di funzioni chiave, come garantire che il nostro
account utente e i nostri file siano disponibili in tutto il sistema
HPC.</p>
</section><section><h2 class="section-heading" id="cosa-cè-in-un-nodo">Cosa c’è in un nodo?<a class="anchor" aria-label="anchor" href="#cosa-c%C3%A8-in-un-nodo"></a>
</h2>
<hr class="half-width">
<p>Tutti i nodi di un sistema HPC hanno gli stessi componenti del vostro
laptop o desktop: <em>CPU</em> (talvolta chiamate anche
<em>processori</em> o <em>core</em>), <em>memoria</em> (o <em>RAM</em>)
e spazio su <em>disco</em>. Le CPU sono lo strumento del computer per
eseguire programmi e calcoli. Le informazioni su un’attività corrente
sono memorizzate nella memoria del computer. Il disco si riferisce a
tutta la memoria a cui si può accedere come un file system. In genere si
tratta di uno spazio di archiviazione che può contenere dati in modo
permanente, vale a dire che i dati sono ancora presenti anche se il
computer è stato riavviato. Anche se questa memoria può essere locale
(un disco rigido installato al suo interno), è più comune che i nodi si
colleghino a un fileserver condiviso e remoto o a un cluster di
server.</p>
<figure><img src="../fig/node_anatomy.png" max-width="20%" caption="" alt="Anatomia del nodo" class="figure mx-auto d-block"><div class="figcaption">Anatomia del nodo</div>
</figure><div id="esplora-il-tuo-computer" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="esplora-il-tuo-computer" class="callout-inner">
<h3 class="callout-title">Esplora il tuo computer</h3>
<div class="callout-content">
<p>Cercate di scoprire il numero di CPU e la quantità di memoria
disponibili sul vostro computer personale. Si noti che, se si è connessi
al cluster di computer remoti, è necessario prima effettuare il logout.
Per farlo, digitare <code>Ctrl+d</code> o <code>exit</code>:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] exit</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>Ci sono diversi modi per farlo. La maggior parte dei sistemi
operativi ha un monitor grafico di sistema, come il Task Manager di
Windows. A volte è possibile trovare informazioni più dettagliate alla
riga di comando. Ad esempio, alcuni dei comandi utilizzati su un sistema
Linux sono:</p>
<p>Esecuzione delle utilità di sistema</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> nproc <span class="at">--all</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> free <span class="at">-m</span></span></code></pre>
</div>
<p>Leggere da <code>/proc</code></p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> cat /proc/cpuinfo</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> cat /proc/meminfo</span></code></pre>
</div>
<p>Utilizzare un monitor di sistema</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> htop</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="esplora-il-nodo-di-login" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="esplora-il-nodo-di-login" class="callout-inner">
<h3 class="callout-title">Esplora il nodo di login</h3>
<div class="callout-content">
<p>Ora confrontate le risorse del vostro computer con quelle del nodo
principale.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> ssh yourUsername@cluster.hpc-carpentry.org</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] nproc <span class="at">--all</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] free <span class="at">-m</span></span></code></pre>
</div>
<p>È possibile ottenere maggiori informazioni sui processori utilizzando
<code>lscpu</code>, e molti dettagli sulla memoria leggendo il file
<code>/proc/meminfo</code>:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] less /proc/meminfo</span></code></pre>
</div>
<p>È anche possibile esplorare i filesystem disponibili usando
<code>df</code> per mostrare lo spazio <strong>d</strong>isk
<strong>f</strong>ree. Il flag <code>-h</code> rende le dimensioni in un
formato facile da usare, cioè GB invece di B. Il flag
<strong>t</strong>ype <code>-T</code> mostra che tipo di filesystem è
ogni risorsa.</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] df <span class="at">-Th</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="discussion1" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Discussion</h3>
<div class="callout-content">
<p>I filesystem locali (ext, tmp, xfs, zfs) dipendono dal fatto che ci
si trovi sullo stesso nodo di accesso (o nodo di calcolo, più avanti). I
filesystem in rete (beegfs, cifs, gpfs, nfs, pvfs) saranno simili — ma
potrebbero includere yourUsername, a seconda di come viene [montato] (<a href="https://en.wikipedia.org/wiki/Mount_(computing)" class="external-link uri">https://en.wikipedia.org/wiki/Mount_(computing)</a>).</p>
</div>
</div>
</div>
<div id="filesystem-condivisi" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="filesystem-condivisi" class="callout-inner">
<h3 class="callout-title">Filesystem condivisi</h3>
<div class="callout-content">
<p>Questo è un punto importante da ricordare: i file salvati su un nodo
(computer) sono spesso disponibili ovunque nel cluster!</p>
</div>
</div>
</div>
<div id="explore-a-worker-node" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="explore-a-worker-node" class="callout-inner">
<h3 class="callout-title">Explore a Worker Node</h3>
<div class="callout-content">
<p>Finally, let’s look at the resources available on the worker nodes
where your jobs will actually run. Try running this command to see the
name, CPUs and memory available on one of the worker nodes:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] sinfo <span class="at">-o</span> <span class="st">"%n %c %m"</span> <span class="kw">|</span> <span class="ex">column</span> <span class="at">-t</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="confronta-il-computer-il-nodo-di-accesso-e-il-nodo-di-calcolo" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="confronta-il-computer-il-nodo-di-accesso-e-il-nodo-di-calcolo" class="callout-inner">
<h3 class="callout-title">Confronta il computer, il nodo di accesso e il nodo di calcolo</h3>
<div class="callout-content">
<p>Confrontate il numero di processori e di memoria del vostro portatile
con i numeri che vedete sul nodo principale del cluster e sul nodo
worker. Discutete le differenze con il vostro vicino.</p>
<p>Quali implicazioni pensi che possano avere le differenze
nell’esecuzione del tuo lavoro di ricerca sui diversi sistemi e
nodi?</p>
</div>
</div>
</div>
<div id="differenze-tra-i-nodi" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="differenze-tra-i-nodi" class="callout-inner">
<h3 class="callout-title">Differenze tra i nodi</h3>
<div class="callout-content">
<p>Molti cluster HPC hanno una varietà di nodi ottimizzati per
particolari carichi di lavoro. Alcuni nodi possono disporre di una
maggiore quantità di memoria o di risorse specializzate come le unità di
elaborazione grafica (GPU).</p>
</div>
</div>
</div>
<p>Con tutto questo in mente, ora vedremo come parlare con lo scheduler
del cluster e usarlo per iniziare a eseguire i nostri script e
programmi!</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>“Un sistema HPC è un insieme di macchine collegate in rete”</li>
<li>“I sistemi HPC forniscono tipicamente nodi di accesso e una serie di
nodi lavoratori.”</li>
<li>“Le risorse presenti sui nodi indipendenti (lavoratori) possono
variare in volume e tipo (quantità di RAM, architettura del processore,
disponibilità di filesystem montati in rete, ecc.)</li>
<li>“I file salvati su un nodo sono disponibili su tutti i nodi.”</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-13-scheduler"><p>Content from <a href="13-scheduler.html">Fondamenti di scheduler</a></p>
<hr>
<p>Last updated on 2025-03-23 |

        <a href="https://github.com/ocaisa/probable-pancake/edit/main/episodes/13-scheduler.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 75 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>Cos’è uno scheduler e perché un cluster ne ha bisogno?</li>
<li>Come si lancia un programma da eseguire su un nodo di calcolo del
cluster?</li>
<li>Come posso catturare l’output di un programma eseguito su un nodo
del cluster?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Invia un semplice script al cluster.</li>
<li>Monitorare l’esecuzione dei lavori utilizzando gli strumenti della
riga di comando.</li>
<li>Ispezionare i file di output e di errore dei lavori.</li>
<li>Trovare il posto giusto per mettere grandi insiemi di dati sul
cluster.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="programmatore-di-lavoro">Programmatore di lavoro<a class="anchor" aria-label="anchor" href="#programmatore-di-lavoro"></a>
</h2>
<hr class="half-width">
<p>Un sistema HPC può avere migliaia di nodi e migliaia di utenti. Come
si decide chi riceve cosa e quando? Come facciamo a garantire che un
task venga eseguito con le risorse di cui ha bisogno? Questo lavoro è
gestito da uno speciale software chiamato <em>scheduler</em>. In un
sistema HPC, lo scheduler gestisce i lavori da eseguire dove e
quando.</p>
<p>L’illustrazione seguente paragona i compiti di uno schedulatore di
lavori a quelli di un cameriere in un ristorante. Se vi è capitato di
dover aspettare un po’ in coda per entrare in un ristorante famoso,
allora potete capire perché a volte i vostri lavori non partono
immediatamente come nel vostro portatile.</p>
<figure><img src="../fig/restaurant_queue_manager.svg" alt="Confronta un job scheduler con un cameriere in un ristorante" max-width="75%" class="figure mx-auto d-block"></figure><p>Lo scheduler utilizzato in questa lezione è Slurm. Sebbene Slurm non
sia utilizzato ovunque, l’esecuzione dei lavori è abbastanza simile
indipendentemente dal software utilizzato. La sintassi esatta può
cambiare, ma i concetti rimangono gli stessi.</p>
</section><section><h2 class="section-heading" id="esecuzione-di-un-lavoro-batch">Esecuzione di un lavoro batch<a class="anchor" aria-label="anchor" href="#esecuzione-di-un-lavoro-batch"></a>
</h2>
<hr class="half-width">
<p>L’uso più semplice dello scheduler è quello di eseguire un comando in
modo non interattivo. Qualsiasi comando (o serie di comandi) che si
desidera eseguire sul cluster è chiamato <em>lavoro</em> e il processo
di utilizzo dello schedulatore per eseguire il lavoro è chiamato
<em>invio di lavori in batch</em>.</p>
<p>In questo caso, il lavoro da eseguire è uno script di shell, ovvero
un file di testo contenente un elenco di comandi UNIX da eseguire in
modo sequenziale. Il nostro script di shell sarà composto da tre
parti:</p>
<ul>
<li>Alla prima riga, aggiungere <code>#!/bin/bash</code>. L’opzione
<code>#!</code> (pronunciata “hash-bang” o “shebang”) indica al computer
quale programma deve elaborare il contenuto di questo file. In questo
caso, gli stiamo dicendo che i comandi che seguono sono scritti per la
shell a riga di comando (con cui abbiamo fatto tutto finora).</li>
<li>in qualsiasi punto sotto la prima riga, aggiungeremo un comando
<code>echo</code> con un saluto amichevole. Una volta eseguito, lo
script di shell stamperà nel terminale qualsiasi cosa venga dopo
<code>echo</code>.
<ul>
<li>
<code>echo -n</code> stamperà tutto ciò che segue, <em>senza</em>
terminare la riga stampando il carattere di nuova riga.</li>
</ul>
</li>
<li>Nell’ultima riga, invocheremo il comando <code>hostname</code>, che
stamperà il nome della macchina su cui viene eseguito lo script.</li>
</ul>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] nano example-job.sh</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-n</span> <span class="st">"This script is running on "</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="fu">hostname</span></span></code></pre>
</div>
<div id="creare-il-nostro-lavoro-di-prova" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="creare-il-nostro-lavoro-di-prova" class="callout-inner">
<h3 class="callout-title">Creare il nostro lavoro di prova</h3>
<div class="callout-content">
<p>Eseguire lo script. Viene eseguito sul cluster o solo sul nostro nodo
di accesso?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Soluzione
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] bash example-job.sh</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>This script is running on login1</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Questo script è stato eseguito sul nodo di login, ma vogliamo
sfruttare i nodi di calcolo: abbiamo bisogno che lo scheduler metta in
coda <code>example-job.sh</code> per eseguirlo su un nodo di
calcolo.</p>
<p>Per inviare questo task allo scheduler, si usa il comando
<code>sbatch</code>. Questo crea un <em>lavoro</em> che eseguirà il
<em>script</em> quando verrà <em>spedito</em> a un nodo di calcolo che
il sistema di accodamento ha identificato come disponibile per eseguire
il lavoro.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] sbatch  example-job.sh</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Submitted batch job 7</code></pre>
</div>
<p>E questo è tutto ciò che dobbiamo fare per inviare un lavoro. Il
nostro lavoro è finito: ora lo scheduler prende il sopravvento e cerca
di eseguire il lavoro per noi. Mentre il lavoro è in attesa di essere
eseguito, viene inserito in un elenco di lavori chiamato <em>queue</em>.
Per verificare lo stato del nostro lavoro, controlliamo la coda usando
il comando <code>squeue -u yourUsername</code>.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] squeue <span class="at">-u</span> yourUsername</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
    9 cpubase_b example-   user01  R       0:05      1 node1</code></pre>
</div>
<p>Possiamo vedere tutti i dettagli del nostro lavoro, soprattutto che è
nello stato <code>R</code> o <code>RUNNING</code>. A volte i nostri
lavori potrebbero dover aspettare in coda (<code>PENDING</code>) o avere
un errore (<code>E</code>).</p>
<div id="dovè-loutput" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="dovè-loutput" class="callout-inner">
<h3 class="callout-title">Dov’è l’output?</h3>
<div class="callout-content">
<p>Nel nodo di accesso, questo script stampava l’output nel terminale,
ma ora, quando <code>squeue</code> mostra che il lavoro è terminato, non
viene stampato nulla nel terminale.</p>
<p>L’output del lavoro del cluster viene solitamente reindirizzato a un
file nella directory da cui è stato lanciato. Usare <code>ls</code> per
trovare e <code>cat</code> per leggere il file.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="personalizzazione-di-un-lavoro">Personalizzazione di un lavoro<a class="anchor" aria-label="anchor" href="#personalizzazione-di-un-lavoro"></a>
</h2>
<hr class="half-width">
<p>Il lavoro appena eseguito ha utilizzato tutte le opzioni predefinite
dello schedulatore. In uno scenario reale, probabilmente non è quello
che vogliamo. Le opzioni predefinite rappresentano un minimo
ragionevole. È probabile che avremo bisogno di più core, più memoria,
più tempo e altre considerazioni speciali. Per avere accesso a queste
risorse, dobbiamo personalizzare il nostro script di lavoro.</p>
<p>I commenti negli script di shell UNIX (indicati con <code>#</code>)
sono generalmente ignorati, ma ci sono delle eccezioni. Per esempio, il
commento speciale <code>#!</code> all’inizio degli script specifica
quale programma deve essere usato per eseguirli (di solito si vede
<code>#!/usr/bin/env bash</code>). Anche gli schedulatori, come Slurm,
hanno un commento speciale usato per indicare opzioni specifiche dello
schedulatore. Sebbene questi commenti differiscano da schedulatore a
schedulatore, il commento speciale di Slurm è <code>#SBATCH</code>.
Tutto ciò che segue il commento <code>#SBATCH</code> viene interpretato
come un’istruzione per lo schedulatore.</p>
<p>Illustriamo questo esempio. Per impostazione predefinita, il nome di
un lavoro è il nome dello script, ma l’opzione <code>-J</code> può
essere usata per cambiare il nome di un lavoro. Aggiungere un’opzione
allo script:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] cat example-job.sh</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="co">#SBATCH -J hello-world</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-n</span> <span class="st">"This script is running on "</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="fu">hostname</span></span></code></pre>
</div>
<p>Inviare il lavoro e monitorarne lo stato:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] sbatch  example-job.sh</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] squeue <span class="at">-u</span> yourUsername</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
   10 cpubase_b hello-wo   user01  R       0:02      1 node1</code></pre>
</div>
<p>Fantastico, abbiamo cambiato con successo il nome del nostro
lavoro!</p>
<div class="section level3">
<h3 id="richieste-di-risorse">Richieste di risorse<a class="anchor" aria-label="anchor" href="#richieste-di-risorse"></a>
</h3>
<p>Che dire di cambiamenti più importanti, come il numero di core e di
memoria per i nostri lavori? Una cosa assolutamente fondamentale quando
si lavora su un sistema HPC è specificare le risorse necessarie per
eseguire un lavoro. Questo permette allo scheduler di trovare il momento
e il posto giusto per programmare il nostro lavoro. Se non si
specificano i requisiti (ad esempio la quantità di tempo necessaria), è
probabile che si rimanga bloccati con le risorse predefinite del sito,
il che probabilmente non è ciò che si desidera.</p>
<p>Le seguenti sono diverse richieste di risorse chiave:</p>
<ul>
<li><p><code>--ntasks=&lt;ntasks&gt;</code> o
<code>-n &lt;ntasks&gt;</code>: Di quanti core di CPU ha bisogno il
vostro lavoro, in totale?</p></li>
<li><p><code>--time &lt;days-hours:minutes:seconds&gt;</code> o
<code>-t &lt;days-hours:minutes:seconds&gt;</code>: Quanto tempo reale
(walltime) impiegherà il lavoro per essere eseguito? La parte
<code>&lt;days&gt;</code> può essere omessa.</p></li>
<li><p><code>--mem=&lt;megabytes&gt;</code>: Di quanta memoria su un
nodo ha bisogno il lavoro in megabyte? Si possono anche specificare i
gigabyte aggiungendo una piccola “g” dopo (esempio:
<code>--mem=5g</code>)</p></li>
<li><p><code>--nodes=&lt;nnodes&gt;</code> o
<code>-N &lt;nnodes&gt;</code>: Su quante macchine separate deve essere
eseguito il lavoro? Si noti che se si imposta <code>ntasks</code> su un
numero superiore a quello che può offrire una sola macchina, Slurm
imposterà automaticamente questo valore.</p></li>
</ul>
<p>Si noti che il solo fatto di <em>richiedere</em> queste risorse non
rende il lavoro più veloce, né significa necessariamente che si
consumeranno tutte queste risorse. Significa solo che vengono messe a
disposizione. Il lavoro può finire per utilizzare meno memoria, meno
tempo o meno nodi di quelli richiesti, ma verrà comunque eseguito.</p>
<p>È meglio che le richieste riflettano accuratamente i requisiti del
lavoro. In una puntata successiva di questa lezione parleremo di come
assicurarsi di utilizzare le risorse in modo efficace.</p>
<div id="invio-di-richieste-di-risorse" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="invio-di-richieste-di-risorse" class="callout-inner">
<h3 class="callout-title">Invio di richieste di risorse</h3>
<div class="callout-content">
<p>Modificare il nostro script <code>hostname</code> in modo che venga
eseguito per un minuto, quindi inviare un lavoro per esso sul
cluster.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  Soluzione
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] cat example-job.sh</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="co">#SBATCH -t 00:01 # timeout in HH:MM</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-n</span> <span class="st">"This script is running on "</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a><span class="fu">sleep</span> 20 <span class="co"># time in seconds</span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="fu">hostname</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] sbatch  example-job.sh</span></code></pre>
</div>
<p>Perché il tempo di esecuzione Slurm e il tempo <code>sleep</code> non
sono identici?</p>
</div>
</div>
</div>
</div>
<p>Le richieste di risorse sono in genere vincolanti. Se si superano, il
lavoro viene eliminato. Utilizziamo il tempo di parete come esempio.
Richiederemo 1 minuto di tempo di parete e cercheremo di eseguire un
lavoro per due minuti.</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] cat example-job.sh</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="co">#SBATCH -J long_job</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="co">#SBATCH -t 00:01 # timeout in HH:MM</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"This script is running on ... "</span></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a><span class="fu">sleep</span> 240 <span class="co"># time in seconds</span></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a><span class="fu">hostname</span></span></code></pre>
</div>
<p>Inviare il lavoro e attendere che finisca. Una volta terminato,
controllare il file di log.</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] sbatch  example-job.sh</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] squeue <span class="at">-u</span> yourUsername</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] cat slurm-12.out</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>This script is running on ...
slurmstepd: error: *** JOB 12 ON node1 CANCELLED AT 2021-02-19T13:55:57
DUE TO TIME LIMIT ***</code></pre>
</div>
<p>Il nostro lavoro è stato annullato per aver superato la quantità di
risorse richieste. Anche se questo sembra un problema, in realtà si
tratta di una caratteristica. Il rispetto rigoroso delle richieste di
risorse consente allo scheduler di trovare il miglior posto possibile
per i lavori. Ancora più importante, garantisce che un altro utente non
possa utilizzare più risorse di quelle che gli sono state assegnate. Se
un altro utente sbaglia e tenta accidentalmente di usare tutti i core o
la memoria di un nodo, Slurm limiterà il suo lavoro alle risorse
richieste o lo ucciderà del tutto. Gli altri lavori sul nodo non ne
risentiranno. Ciò significa che un utente non può rovinare l’esperienza
degli altri: gli unici lavori interessati da un errore di programmazione
saranno i propri.</p>
</div>
</section><section><h2 class="section-heading" id="annullamento-di-un-lavoro">Annullamento di un lavoro<a class="anchor" aria-label="anchor" href="#annullamento-di-un-lavoro"></a>
</h2>
<hr class="half-width">
<p>A volte capita di commettere un errore e di dover cancellare un
lavoro. Questo può essere fatto con il comando <code>scancel</code>.
Inviamo un lavoro e poi annulliamolo usando il suo numero di lavoro
(ricordate di cambiare il tempo di esecuzione in modo che funzioni
abbastanza a lungo da permettervi di annullarlo prima che venga
ucciso).</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] sbatch  example-job.sh</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] squeue <span class="at">-u</span> yourUsername</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Submitted batch job 13

JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
   13 cpubase_b long_job   user01  R       0:02      1 node1</code></pre>
</div>
<p>Ora annullate il lavoro con il suo numero (stampato nel terminale).
Un ritorno pulito del prompt dei comandi indica che la richiesta di
annullamento del lavoro è andata a buon fine.</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] scancel 38759</span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a><span class="co"># It might take a minute for the job to disappear from the queue...</span></span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] squeue <span class="at">-u</span> yourUsername</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)</code></pre>
</div>
<div id="annullamento-di-lavori-multipli" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="annullamento-di-lavori-multipli" class="callout-inner">
<h3 class="callout-title">Annullamento di lavori multipli</h3>
<div class="callout-content">
<p>È anche possibile cancellare tutti i lavori in una volta sola usando
l’opzione <code>-u</code>. In questo modo si cancellano tutti i lavori
di un utente specifico (in questo caso, l’utente stesso). Si noti che è
possibile cancellare solo i propri lavori.</p>
<p>Provare a inviare più lavori e poi annullarli tutti.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  Soluzione
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<p>Per prima cosa, inviare un trio di lavori:</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] sbatch  example-job.sh</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] sbatch  example-job.sh</span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] sbatch  example-job.sh</span></code></pre>
</div>
<p>Poi, annullarli tutti:</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] scancel <span class="at">-u</span> yourUsername</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="altri-tipi-di-lavoro">Altri tipi di lavoro<a class="anchor" aria-label="anchor" href="#altri-tipi-di-lavoro"></a>
</h2>
<hr class="half-width">
<p>Finora ci siamo concentrati sull’esecuzione di lavori in modalità
batch. <code>Slurm</code> offre anche la possibilità di avviare una
sessione interattiva.</p>
<p>Molto spesso ci sono compiti che devono essere eseguiti in modo
interattivo. Creare un intero script di lavoro potrebbe essere
eccessivo, ma la quantità di risorse richieste è troppo elevata per
essere gestita da un nodo di login. Un buon esempio potrebbe essere la
creazione di un indice del genoma per l’allineamento con uno strumento
come <a href="https://daehwankimlab.github.io/hisat2/" class="external-link">HISAT2</a>.
Fortunatamente, è possibile eseguire questo tipo di compiti una tantum
con <code>srun</code>.</p>
<p><code>srun</code> esegue un singolo comando sul cluster e poi esce.
Dimostriamo questo eseguendo il comando <code>hostname</code> con
<code>srun</code>. (È possibile annullare un lavoro <code>srun</code>
con <code>Ctrl-c</code>)</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] srun hostname</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">smnode1</span></span></code></pre>
</div>
<p><code>srun</code> accetta tutte le stesse opzioni di
<code>sbatch</code>. Tuttavia, invece di specificarle in uno script,
queste opzioni vengono specificate sulla riga di comando quando si avvia
un lavoro. Per inviare un lavoro che utilizza 2 CPU, ad esempio, si può
usare il seguente comando:</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] srun <span class="at">-n</span> 2 echo <span class="st">"This job will use 2 CPUs."</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>This job will use 2 CPUs.
This job will use 2 CPUs.</code></pre>
</div>
<p>In genere, l’ambiente di shell risultante sarà lo stesso di quello di
<code>sbatch</code>.</p>
<div class="section level3">
<h3 id="lavori-interattivi">Lavori interattivi<a class="anchor" aria-label="anchor" href="#lavori-interattivi"></a>
</h3>
<p>A volte si ha bisogno di molte risorse per l’uso interattivo. Forse è
la prima volta che si esegue un’analisi o si sta cercando di eseguire il
debug di qualcosa che è andato storto con un lavoro precedente.
Fortunatamente, Slurm semplifica l’avvio di un lavoro interattivo con
<code>srun</code>:</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] srun <span class="at">--pty</span> bash</span></code></pre>
</div>
<p>Dovrebbe apparire un prompt di bash. Si noti che il prompt
probabilmente cambierà per riflettere la nuova posizione, in questo caso
il nodo di calcolo su cui si è effettuato l’accesso. Si può anche
verificare con <code>hostname</code>.</p>
<div id="creazione-della-grafica-remota" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="creazione-della-grafica-remota" class="callout-inner">
<h3 class="callout-title">Creazione della grafica remota</h3>
<div class="callout-content">
<p>Per vedere l’output grafico dei lavori, è necessario utilizzare
l’inoltro X11. Per connettersi con questa funzione abilitata, usare
l’opzione <code>-Y</code> quando si effettua il login con il comando
<code>ssh</code>, ad esempio,
<code>ssh -Y yourUsername@cluster.hpc-carpentry.org</code>.</p>
<p>Per dimostrare cosa succede quando si crea una finestra grafica sul
nodo remoto, usare il comando <code>xeyes</code>. Dovrebbe apparire un
paio di occhi relativamente adorabili (premere <code>Ctrl-C</code> per
fermarsi). Se si utilizza un Mac, è necessario aver installato XQuartz
(e riavviato il computer) perché questo funzioni.</p>
<p>Se nel cluster è installato il plugin <a href="https://github.com/hautreux/slurm-spank-x11" class="external-link">slurm-spank-x11</a>,
si può garantire l’inoltro X11 nei lavori interattivi usando l’opzione
<code>--x11</code> per <code>srun</code> con il comando
<code>srun --x11 --pty bash</code>.</p>
</div>
</div>
</div>
<p>Al termine del lavoro interattivo, digitare <code>exit</code> per
uscire dalla sessione.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Lo scheduler gestisce la condivisione delle risorse di calcolo tra
gli utenti.</li>
<li>Un lavoro è solo uno script di shell.</li>
<li>Richiedere <em>poco</em> più risorse di quelle necessarie.</li>
</ul>
</div>
</div>
</div>
</div>
</section></section><section id="aio-14-environment-variables"><p>Content from <a href="14-environment-variables.html">Variabili d'ambiente</a></p>
<hr>
<p>Last updated on 2025-03-23 |

        <a href="https://github.com/ocaisa/probable-pancake/edit/main/episodes/14-environment-variables.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 15 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>Come si impostano e si accede alle variabili nella shell Unix?</li>
<li>Come si possono usare le variabili per cambiare l’esecuzione di un
programma?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Capire come vengono implementate le variabili nella shell</li>
<li>leggere il valore di una variabile esistente</li>
<li>Creare nuove variabili e cambiarne i valori</li>
<li>Modificare il comportamento di un programma utilizzando una
variabile d’ambiente</li>
<li>Spiegare come la shell utilizza la variabile <code>PATH</code> per
cercare gli eseguibili</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="provenienza-dellepisodio" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="provenienza-dellepisodio" class="callout-inner">
<h3 class="callout-title">Provenienza dell’episodio</h3>
<div class="callout-content">
<p>Questo episodio è stato remixato dall’episodio <a href="https://github.com/carpentries-incubator/shell-extras/blob/gh-pages/_episodes/08-environment-variables.md" class="external-link">Shell
Extras sulle variabili di shell</a> e dall’episodio <a href="https://github.com/hpc-carpentry/hpc-shell/blob/gh-pages/_episodes/05-scripts.md" class="external-link">HPC
Shell sugli script</a>.</p>
</div>
</div>
</div>
<p>La shell è solo un programma e, come gli altri programmi, ha delle
variabili. Queste variabili controllano la sua esecuzione, quindi
cambiando i loro valori si può cambiare il comportamento della shell (e,
con un po’ più di sforzo, il comportamento degli altri programmi).</p>
<p>Le variabili sono un ottimo modo per salvare informazioni con un nome
a cui si può accedere in seguito. Nei linguaggi di programmazione come
Python e R, le variabili possono memorizzare praticamente tutto ciò che
si può pensare. Nella shell, di solito, memorizzano solo testo. Il modo
migliore per capire come funzionano è vederle in azione.</p>
<p>Cominciamo con l’eseguire il comando <code>set</code> e osserviamo
alcune delle variabili in una tipica sessione di shell:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="bu">set</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>COMPUTERNAME=TURING
HOME=/home/vlad
HOSTNAME=TURING
HOSTTYPE=i686
NUMBER_OF_PROCESSORS=4
PATH=/Users/vlad/bin:/usr/local/git/bin:/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin
PWD=/home/vlad
UID=1000
USERNAME=vlad
...</code></pre>
</div>
<p>Come si può vedere, ce ne sono parecchie, anzi quattro o cinque volte
di più di quelle mostrate qui. E sì, l’uso di <code>set</code> per
<em>mostrare</em> le cose può sembrare un po’ strano, anche per Unix, ma
se non gli si dà alcun argomento, può anche mostrare cose che si possono
<em>impostare</em>.</p>
<p>Ogni variabile ha un nome. Tutti i valori delle variabili di shell
sono stringhe, anche quelle (come <code>UID</code>) che sembrano numeri.
Spetta ai programmi convertire queste stringhe in altri tipi, se
necessario. Per esempio, se un programma volesse sapere quanti
processori ha il computer, convertirebbe il valore della variabile
<code>NUMBER_OF_PROCESSORS</code> da una stringa a un numero intero.</p>
<section><h2 class="section-heading" id="mostrare-il-valore-di-una-variabile">Mostrare il valore di una variabile<a class="anchor" aria-label="anchor" href="#mostrare-il-valore-di-una-variabile"></a>
</h2>
<hr class="half-width">
<p>Mostriamo il valore della variabile <code>HOME</code>:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="bu">echo</span> HOME</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">HOME</span></span></code></pre>
</div>
<p>Questo stampa solo “HOME”, che non è quello che volevamo (anche se è
quello che abbiamo effettivamente chiesto). Proviamo invece questo:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$HOME</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>/home/vlad</code></pre>
</div>
<p>il segno del dollaro indica alla shell che vogliamo il
<em>valore</em> della variabile piuttosto che il suo nome. Questo
funziona proprio come i caratteri jolly: la shell effettua la
sostituzione <em>prima</em> di eseguire il programma richiesto. Grazie a
questa espansione, ciò che viene eseguito è
<code>echo /home/vlad</code>, che mostra la cosa giusta.</p>
</section><section><h2 class="section-heading" id="creazione-e-modifica-di-variabili">Creazione e modifica di variabili<a class="anchor" aria-label="anchor" href="#creazione-e-modifica-di-variabili"></a>
</h2>
<hr class="half-width">
<p>Creare una variabile è facile: basta assegnare un valore a un nome
usando “=” (bisogna solo ricordare che la sintassi richiede che non ci
siano spazi intorno a <code>=</code>):</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="va">SECRET_IDENTITY</span><span class="op">=</span>Dracula</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$SECRET_IDENTITY</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">Dracula</span></span></code></pre>
</div>
<p>Per cambiare il valore, basta assegnarne uno nuovo:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="va">SECRET_IDENTITY</span><span class="op">=</span>Camilla</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$SECRET_IDENTITY</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">Camilla</span></span></code></pre>
</div>
</section><section><h2 class="section-heading" id="variabili-dambiente">Variabili d’ambiente<a class="anchor" aria-label="anchor" href="#variabili-dambiente"></a>
</h2>
<hr class="half-width">
<p>Quando abbiamo eseguito il comando <code>set</code> abbiamo visto che
c’erano molte variabili i cui nomi erano in maiuscolo. Questo perché,
per convenzione, le variabili che sono disponibili per l’uso da parte di
<em>altri</em> programmi hanno nomi maiuscoli. Tali variabili sono
chiamate <em>variabili d’ambiente</em> in quanto sono variabili di shell
definite per la shell corrente ed ereditate da qualsiasi shell o
processo figlio.</p>
<p>Per creare una variabile d’ambiente è necessario <code>export</code>
una variabile di shell. Ad esempio, per rendere la nostra
<code>SECRET_IDENTITY</code> disponibile ad altri programmi che
chiamiamo dalla nostra shell, possiamo fare:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="va">SECRET_IDENTITY</span><span class="op">=</span>Camilla</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="bu">export</span> <span class="va">SECRET_IDENTITY</span></span></code></pre>
</div>
<p>È anche possibile creare ed esportare la variabile in un unico
passaggio:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="bu">export</span> <span class="va">SECRET_IDENTITY</span><span class="op">=</span>Camilla</span></code></pre>
</div>
<div id="usare-le-variabili-dambiente-per-cambiare-il-comportamento-del-programma" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="usare-le-variabili-dambiente-per-cambiare-il-comportamento-del-programma" class="callout-inner">
<h3 class="callout-title">Usare le variabili d’ambiente per cambiare il comportamento del programma</h3>
<div class="callout-content">
<p>Impostare una variabile di shell <code>TIME_STYLE</code> per avere un
valore di <code>iso</code> e controllare questo valore con il comando
<code>echo</code>.</p>
<p>Ora, eseguite il comando <code>ls</code> con l’opzione
<code>-l</code> (che dà un formato lungo).</p>
<p><code>export</code> la variabile e rieseguire il comando
<code>ls -l</code>. Notate qualche differenza?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Soluzione
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>La variabile <code>TIME_STYLE</code> non viene <em>vista</em> da
<code>ls</code> fino a quando non viene esportata, a quel punto viene
usata da <code>ls</code> per decidere quale formato di data usare quando
presenta il timestamp dei file.</p>
</div>
</div>
</div>
</div>
<p>È possibile vedere l’insieme completo delle variabili d’ambiente
nella sessione corrente della shell con il comando <code>env</code> (che
restituisce un sottoinsieme di ciò che ci ha dato il comando
<code>set</code>). <strong>L’insieme completo delle variabili d’ambiente
è chiamato <em>ambiente di esecuzione</em> e può influenzare il
comportamento dei programmi eseguiti</strong>.</p>
<div id="variabili-dambiente-di-lavoro" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="variabili-dambiente-di-lavoro" class="callout-inner">
<h3 class="callout-title">Variabili d’ambiente di lavoro</h3>
<div class="callout-content">
<p>Quando <code>Slurm</code> esegue un lavoro, imposta una serie di
variabili d’ambiente per il lavoro. Una di queste ci permette di
verificare da quale directory è stato inviato lo script del lavoro. La
variabile <code>SLURM_SUBMIT_DIR</code> è impostata sulla directory da
cui è stato inviato il lavoro. Utilizzando la variabile
<code>SLURM_SUBMIT_DIR</code>, modificate il vostro lavoro in modo che
stampi la posizione da cui è stato inviato il lavoro.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  Soluzione
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] nano example-job.sh</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] cat example-job.sh</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>#!/bin/bash
#SBATCH -t 00:00:30

echo -n "This script is running on "
hostname

echo "This job was launched in the following directory:"
echo ${SLURM_SUBMIT_DIR}</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Per rimuovere una variabile o una variabile d’ambiente si può usare
il comando <code>unset</code>, ad esempio:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="bu">unset</span> <span class="va">SECRET_IDENTITY</span></span></code></pre>
</div>
</section><section><h2 class="section-heading" id="la-variabile-dambiente-path">La variabile d’ambiente <code>PATH</code>
<a class="anchor" aria-label="anchor" href="#la-variabile-dambiente-path"></a>
</h2>
<hr class="half-width">
<p>Analogamente, alcune variabili d’ambiente (come <code>PATH</code>)
memorizzano elenchi di valori. In questo caso, la convenzione è di usare
i due punti ‘:’ come separatore. Se un programma vuole i singoli
elementi di un tale elenco, è sua responsabilità dividere il valore
della stringa della variabile in pezzi.</p>
<p>Diamo un’occhiata più da vicino alla variabile <code>PATH</code>. Il
suo valore definisce il percorso di ricerca degli eseguibili della
shell, cioè l’elenco delle directory in cui la shell cerca i programmi
eseguibili quando si digita il nome di un programma senza specificare la
directory in cui si trova.</p>
<p>Ad esempio, quando si digita un comando come <code>analyze</code>, la
shell deve decidere se eseguire <code>./analyze</code> o
<code>/bin/analyze</code>. La regola che utilizza è semplice: la shell
controlla ogni directory della variabile <code>PATH</code> a turno,
cercando un programma con il nome richiesto in quella directory. Non
appena trova una corrispondenza, interrompe la ricerca ed esegue il
programma.</p>
<p>Per mostrare come funziona, ecco i componenti di <code>PATH</code>
elencati uno per riga:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>/Users/vlad/bin
/usr/local/git/bin
/usr/bin
/bin
/usr/sbin
/sbin
/usr/local/bin</code></pre>
</div>
<p>Sul nostro computer, ci sono in realtà tre programmi chiamati
<code>analyze</code> in tre diverse directory:
<code>/bin/analyze</code>, <code>/usr/local/bin/analyze</code> e
<code>/users/vlad/analyze</code>. Poiché la shell cerca le directory
nell’ordine in cui sono elencate in <code>PATH</code>, trova prima
<code>/bin/analyze</code> e lo esegue. Si noti che non troverà mai il
programma <code>/users/vlad/analyze</code> a meno che non si digiti il
percorso completo del programma, poiché la directory
<code>/users/vlad</code> non si trova in <code>PATH</code>.</p>
<p>Questo significa che posso avere eseguibili in molti posti diversi,
purché mi ricordi che devo aggiornare il mio <code>PATH</code> in modo
che la mia shell possa trovarli.</p>
<p>Cosa succede se si vogliono eseguire due versioni diverse dello
stesso programma? Dato che condividono lo stesso nome, se le aggiungo
entrambe alla mia <code>PATH</code> la prima che viene trovata avrà
sempre la meglio. Nel prossimo episodio impareremo a usare strumenti di
aiuto per gestire il nostro ambiente di runtime, in modo da renderlo
possibile senza dover fare un sacco di conti su quale sia o debba essere
il valore di <code>PATH</code> (e di altre importanti variabili
d’ambiente).</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Le variabili di shell sono trattate per impostazione predefinita
come stringhe</li>
<li>Le variabili vengono assegnate utilizzando “<code>=</code>” e
richiamate utilizzando il nome della variabile preceduto da
“<code>$</code>”</li>
<li>Usare “<code>export</code>” per rendere una variabile disponibile ad
altri programmi</li>
<li>La variabile <code>PATH</code> definisce il percorso di ricerca
della shell</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-15-modules"><p>Content from <a href="15-modules.html">Accesso al software tramite moduli</a></p>
<hr>
<p>Last updated on 2025-03-23 |

        <a href="https://github.com/ocaisa/probable-pancake/edit/main/episodes/15-modules.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 45 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>Come si caricano e scaricano i pacchetti software?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Carica e utilizza un pacchetto software.</li>
<li>Spiegate come cambia l’ambiente della shell quando il meccanismo dei
moduli carica o scarica i pacchetti.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>In un sistema di calcolo ad alte prestazioni, raramente il software
che vogliamo usare è disponibile al momento dell’accesso. È installato,
ma è necessario “caricarlo” prima che possa essere eseguito.</p>
<p>Prima di iniziare a utilizzare i singoli pacchetti software,
tuttavia, è necessario comprendere il ragionamento alla base di questo
approccio. I tre fattori principali sono:</p>
<ul>
<li>incompatibilità software</li>
<li>versioning</li>
<li>dipendenze</li>
</ul>
<p>L’incompatibilità del software è un grosso grattacapo per i
programmatori. A volte, la presenza (o l’assenza) di un pacchetto
software ne rompe altri che dipendono da esso. Due esempi ben noti sono
le versioni dei compilatori Python e C. Python 3 fornisce un comando
<code>python</code> che è in conflitto con quello fornito da Python 2.
Il software compilato con una versione più recente del compilatore C non
è in grado di funzionare. Il software compilato con una versione più
recente delle librerie C e poi eseguito su una macchina in cui sono
installate librerie C più vecchie, darà luogo a uno spiacevole errore
<code>'GLIBCXX_3.4.20' not found</code>.</p>
<p>La gestione delle versioni del software è un altro problema comune.
Un gruppo di lavoro potrebbe dipendere da una certa versione di un
pacchetto per il proprio progetto di ricerca; se la versione del
software dovesse cambiare (per esempio, se un pacchetto venisse
aggiornato), i risultati potrebbero risentirne. Avere accesso a più
versioni del software permette a un gruppo di ricercatori di evitare che
i problemi di versione del software influenzino i loro risultati.</p>
<p>Le dipendenze sono quando un particolare pacchetto software (o anche
una particolare versione) dipende dall’accesso a un altro pacchetto
software (o anche a una particolare versione di un altro pacchetto
software). Ad esempio, il software per la scienza dei materiali VASP può
dipendere dalla disponibilità di una particolare versione della libreria
software FFTW (Fastest Fourier Transform in the West) per
funzionare.</p>
<section><h2 class="section-heading" id="moduli-dambiente">Moduli d’ambiente<a class="anchor" aria-label="anchor" href="#moduli-dambiente"></a>
</h2>
<hr class="half-width">
<p>I moduli d’ambiente sono la soluzione a questi problemi. Un
<em>modulo</em> è una descrizione autonoma di un pacchetto software:
contiene le impostazioni necessarie per eseguire un pacchetto software
e, di solito, codifica le dipendenze necessarie da altri pacchetti
software.</p>
<p>Esistono diverse implementazioni di moduli di ambiente comunemente
utilizzate sui sistemi HPC: le due più comuni sono <em>TCL modules</em>
e <em>Lmod</em>. Entrambi utilizzano una sintassi simile e i concetti
sono gli stessi, quindi imparare a usarne uno vi permetterà di
utilizzare quello installato sul sistema che state usando. In entrambe
le implementazioni il comando <code>module</code> è usato per interagire
con i moduli di ambiente. Al comando viene solitamente aggiunto un
ulteriore sottocomando per specificare ciò che si vuole fare. Per un
elenco di sottocomandi si può usare <code>module -h</code> o
<code>module help</code>. Come per tutti i comandi, è possibile accedere
alla guida completa nelle pagine di <em>man</em> con
<code>man module</code>.</p>
<p>All’accesso si può iniziare con un set predefinito di moduli caricati
o con un ambiente vuoto; ciò dipende dalla configurazione del sistema in
uso.</p>
<div class="section level3">
<h3 id="elenco-dei-moduli-disponibili">Elenco dei moduli disponibili<a class="anchor" aria-label="anchor" href="#elenco-dei-moduli-disponibili"></a>
</h3>
<p>Per vedere i moduli software disponibili, usare
<code>module avail</code>:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] module avail</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>~~~ /cvmfs/pilot.eessi-hpc.org/2020.12/software/x86_64/amd/zen2/modules/all ~~~
  Bazel/3.6.0-GCCcore-x.y.z              NSS/3.51-GCCcore-x.y.z
  Bison/3.5.3-GCCcore-x.y.z              Ninja/1.10.0-GCCcore-x.y.z
  Boost/1.72.0-gompi-2020a               OSU-Micro-Benchmarks/5.6.3-gompi-2020a
  CGAL/4.14.3-gompi-2020a-Python-3.x.y   OpenBLAS/0.3.9-GCC-x.y.z
  CMake/3.16.4-GCCcore-x.y.z             OpenFOAM/v2006-foss-2020a

[removed most of the output here for clarity]

  Where:
   L:        Module is loaded
   Aliases:  Aliases exist: foo/1.2.3 (1.2) means that "module load foo/1.2"
             will load foo/1.2.3
   D:        Default Module

Use "module spider" to find all possible modules and extensions.
Use "module keyword key1 key2 ..." to search for all possible modules matching
any of the "keys".</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="elenco-dei-moduli-attualmente-caricati">Elenco dei moduli attualmente caricati<a class="anchor" aria-label="anchor" href="#elenco-dei-moduli-attualmente-caricati"></a>
</h3>
<p>Si può usare il comando <code>module list</code> per vedere quali
moduli sono attualmente caricati nel proprio ambiente. Se non è stato
caricato alcun modulo, verrà visualizzato un messaggio che lo indica</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] module list</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>No Modulefiles Currently Loaded.</code></pre>
</div>
</div>
</section><section><h2 class="section-heading" id="caricamento-e-scaricamento-del-software">Caricamento e scaricamento del software<a class="anchor" aria-label="anchor" href="#caricamento-e-scaricamento-del-software"></a>
</h2>
<hr class="half-width">
<p>Per caricare un modulo software, usare <code>module load</code>. In
questo esempio useremo Python 3.</p>
<p>Inizialmente, Python 3 non viene caricato. Si può verificare usando
il comando <code>which</code>. il comando <code>which</code> cerca i
programmi nello stesso modo in cui lo fa Bash, quindi possiamo usarlo
per sapere dove è memorizzato un particolare software.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] which python3</span></code></pre>
</div>
<p>Se il comando <code>python3</code> non fosse disponibile, si vedrebbe
un risultato come</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>/usr/bin/which: no python3 in (/cvmfs/pilot.eessi-hpc.org/2020.12/compat/linux/x86_64/usr/bin:/opt/software/slurm/bin:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/opt/puppetlabs/bin:/home/yourUsername/.local/bin:/home/yourUsername/bin)</code></pre>
</div>
<p>Si noti che questo muro di testo è in realtà un elenco, con i valori
separati dal carattere <code>:</code>. L’output ci dice che il comando
<code>which</code> ha cercato <code>python3</code> nelle seguenti
directory, senza successo:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>/cvmfs/pilot.eessi-hpc.org/2020.12/compat/linux/x86_64/usr/bin
/opt/software/slurm/bin
/usr/local/bin
/usr/bin
/usr/local/sbin
/usr/sbin
/opt/puppetlabs/bin
/home/yourUsername/.local/bin
/home/yourUsername/bin</code></pre>
</div>
<p>Tuttavia, nel nostro caso abbiamo un <code>python3</code> esistente
disponibile, quindi vediamo</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>/cvmfs/pilot.eessi-hpc.org/2020.12/compat/linux/x86_64/usr/bin/python3</code></pre>
</div>
<p>Abbiamo bisogno di un Python diverso da quello fornito dal sistema,
quindi carichiamo un modulo per accedervi.</p>
<p>Possiamo caricare il comando <code>python3</code> con
<code>module load</code>:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] module load Python</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] which python3</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>/cvmfs/pilot.eessi-hpc.org/2020.12/software/x86_64/amd/zen2/software/Python/3.x.y-GCCcore-x.y.z/bin/python3</code></pre>
</div>
<p>Allora, cosa è successo?</p>
<p>Per comprendere l’output, occorre innanzitutto capire la natura della
variabile d’ambiente <code>$PATH</code>. <code>$PATH</code> è una
variabile d’ambiente speciale che controlla dove un sistema UNIX cerca
il software. In particolare, <code>$PATH</code> è un elenco di directory
(separate da <code>:</code>) in cui il sistema operativo cerca un
comando prima di arrendersi e dire che non lo trova. Come per tutte le
variabili d’ambiente, è possibile stamparle usando
<code>echo</code>.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] echo <span class="va">$PATH</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>/cvmfs/pilot.eessi-hpc.org/2020.12/software/x86_64/amd/zen2/software/Python/3.x.y-GCCcore-x.y.z/bin:/cvmfs/pilot.eessi-hpc.org/2020.12/software/x86_64/amd/zen2/software/SQLite/3.31.1-GCCcore-x.y.z/bin:/cvmfs/pilot.eessi-hpc.org/2020.12/software/x86_64/amd/zen2/software/Tcl/8.6.10-GCCcore-x.y.z/bin:/cvmfs/pilot.eessi-hpc.org/2020.12/software/x86_64/amd/zen2/software/GCCcore/x.y.z/bin:/cvmfs/pilot.eessi-hpc.org/2020.12/compat/linux/x86_64/usr/bin:/opt/software/slurm/bin:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/opt/puppetlabs/bin:/home/user01/.local/bin:/home/user01/bin</code></pre>
</div>
<p>Noterete una somiglianza con l’output del comando <code>which</code>.
In questo caso, c’è solo una differenza: la diversa directory
all’inizio. Quando abbiamo eseguito il comando <code>module load</code>,
questo ha aggiunto una directory all’inizio del nostro
<code>$PATH</code>. Esaminiamo cosa c’è:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] ls /cvmfs/pilot.eessi-hpc.org/2020.12/software/x86_64/amd/zen2/software/Python/3.x.y-GCCcore-x.y.z/bin</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>2to3              nosetests-3.8  python                 rst2s5.py
2to3-3.8          pasteurize     python3                rst2xetex.py
chardetect        pbr            python3.8              rst2xml.py
cygdb             pip            python3.8-config       rstpep2html.py
cython            pip3           python3-config         runxlrd.py
cythonize         pip3.8         rst2html4.py           sphinx-apidoc
easy_install      pybabel        rst2html5.py           sphinx-autogen
easy_install-3.8  __pycache__    rst2html.py            sphinx-build
futurize          pydoc3         rst2latex.py           sphinx-quickstart
idle3             pydoc3.8       rst2man.py             tabulate
idle3.8           pygmentize     rst2odt_prepstyles.py  virtualenv
netaddr           pytest         rst2odt.py             wheel
nosetests         py.test        rst2pseudoxml.py</code></pre>
</div>
<p>Portando questo alla sua conclusione, <code>module load</code>
aggiungerà software al vostro <code>$PATH</code>. Carica il software.
Una nota speciale: a seconda della versione del programma
<code>module</code> installata nel sito, <code>module load</code>
caricherà anche le dipendenze software necessarie.</p>
<p>Per dimostrarlo, usiamo
<code>module list</code>.<code>module list</code> mostra tutti i moduli
software caricati.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] module list</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Currently Loaded Modules:
  1) GCCcore/x.y.z                 4) GMP/6.2.0-GCCcore-x.y.z
  2) Tcl/8.6.10-GCCcore-x.y.z      5) libffi/3.3-GCCcore-x.y.z
  3) SQLite/3.31.1-GCCcore-x.y.z   6) Python/3.x.y-GCCcore-x.y.z</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] module load GROMACS</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] module list</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Currently Loaded Modules:
  1) GCCcore/x.y.z                    14) libfabric/1.11.0-GCCcore-x.y.z
  2) Tcl/8.6.10-GCCcore-x.y.z         15) PMIx/3.1.5-GCCcore-x.y.z
  3) SQLite/3.31.1-GCCcore-x.y.z      16) OpenMPI/4.0.3-GCC-x.y.z
  4) GMP/6.2.0-GCCcore-x.y.z          17) OpenBLAS/0.3.9-GCC-x.y.z
  5) libffi/3.3-GCCcore-x.y.z         18) gompi/2020a
  6) Python/3.x.y-GCCcore-x.y.z       19) FFTW/3.3.8-gompi-2020a
  7) GCC/x.y.z                        20) ScaLAPACK/2.1.0-gompi-2020a
  8) numactl/2.0.13-GCCcore-x.y.z     21) foss/2020a
  9) libxml2/2.9.10-GCCcore-x.y.z     22) pybind11/2.4.3-GCCcore-x.y.z-Pytho...
 10) libpciaccess/0.16-GCCcore-x.y.z  23) SciPy-bundle/2020.03-foss-2020a-Py...
 11) hwloc/2.2.0-GCCcore-x.y.z        24) networkx/2.4-foss-2020a-Python-3.8...
 12) libevent/2.1.11-GCCcore-x.y.z    25) GROMACS/2020.1-foss-2020a-Python-3...
 13) UCX/1.8.0-GCCcore-x.y.z</code></pre>
</div>
<p>In questo caso, il caricamento del modulo <code>GROMACS</code> (un
pacchetto software bioinformatico) ha caricato anche
<code>GMP/6.2.0-GCCcore-x.y.z</code> e
<code>SciPy-bundle/2020.03-foss-2020a-Python-3.x.y</code>. Proviamo a
scaricare il pacchetto <code>GROMACS</code>.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] module unload GROMACS</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] module list</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Currently Loaded Modules:
  1) GCCcore/x.y.z                    13) UCX/1.8.0-GCCcore-x.y.z
  2) Tcl/8.6.10-GCCcore-x.y.z         14) libfabric/1.11.0-GCCcore-x.y.z
  3) SQLite/3.31.1-GCCcore-x.y.z      15) PMIx/3.1.5-GCCcore-x.y.z
  4) GMP/6.2.0-GCCcore-x.y.z          16) OpenMPI/4.0.3-GCC-x.y.z
  5) libffi/3.3-GCCcore-x.y.z         17) OpenBLAS/0.3.9-GCC-x.y.z
  6) Python/3.x.y-GCCcore-x.y.z       18) gompi/2020a
  7) GCC/x.y.z                        19) FFTW/3.3.8-gompi-2020a
  8) numactl/2.0.13-GCCcore-x.y.z     20) ScaLAPACK/2.1.0-gompi-2020a
  9) libxml2/2.9.10-GCCcore-x.y.z     21) foss/2020a
 10) libpciaccess/0.16-GCCcore-x.y.z  22) pybind11/2.4.3-GCCcore-x.y.z-Pytho...
 11) hwloc/2.2.0-GCCcore-x.y.z        23) SciPy-bundle/2020.03-foss-2020a-Py...
 12) libevent/2.1.11-GCCcore-x.y.z    24) networkx/2.4-foss-2020a-Python-3.x.y</code></pre>
</div>
<p>Quindi l’uso di <code>module unload</code> “scarica” un modulo e, a
seconda di come è configurato un sito, può anche scaricare tutte le
dipendenze (nel nostro caso non lo fa). Se si volesse scaricare tutto in
una volta, si potrebbe eseguire <code>module purge</code> (scarica
tutto).</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] module purge</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] module list</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>No modules loaded</code></pre>
</div>
<p>Si noti che <code>module purge</code> è informativo. Ci farà anche
sapere se un insieme predefinito di pacchetti “appiccicosi” non può
essere scaricato (e come scaricarli se lo si desidera veramente).</p>
<p>Si noti che questo processo di caricamento del modulo avviene
principalmente attraverso la manipolazione di variabili d’ambiente come
<code>$PATH</code>. Di solito il trasferimento di dati è minimo o
nullo.</p>
<p>Il processo di caricamento dei moduli manipola anche altre variabili
d’ambiente speciali, tra cui quelle che influenzano la ricerca delle
librerie software da parte del sistema e, talvolta, quelle che indicano
ai pacchetti software commerciali dove trovare i server delle
licenze.</p>
<p>Il comando module ripristina anche queste variabili d’ambiente della
shell al loro stato precedente quando un modulo viene scaricato.</p>
</section><section><h2 class="section-heading" id="versione-del-software">Versione del software<a class="anchor" aria-label="anchor" href="#versione-del-software"></a>
</h2>
<hr class="half-width">
<p>Finora abbiamo imparato a caricare e scaricare i pacchetti software.
Questo è molto utile. Tuttavia, non abbiamo ancora affrontato il
problema del versionamento del software. Prima o poi ci si imbatterà in
problemi in cui solo una particolare versione di un software sarà
adatta. Forse la correzione di un bug fondamentale è avvenuta solo in
una certa versione, oppure la versione X ha interrotto la compatibilità
con un formato di file utilizzato. In entrambi questi casi, è utile
essere molto precisi sul software caricato.</p>
<p>Esaminiamo più da vicino l’output di <code>module avail</code>.</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] module avail</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>~~~ /cvmfs/pilot.eessi-hpc.org/2020.12/software/x86_64/amd/zen2/modules/all ~~~
  Bazel/3.6.0-GCCcore-x.y.z              NSS/3.51-GCCcore-x.y.z
  Bison/3.5.3-GCCcore-x.y.z              Ninja/1.10.0-GCCcore-x.y.z
  Boost/1.72.0-gompi-2020a               OSU-Micro-Benchmarks/5.6.3-gompi-2020a
  CGAL/4.14.3-gompi-2020a-Python-3.x.y   OpenBLAS/0.3.9-GCC-x.y.z
  CMake/3.16.4-GCCcore-x.y.z             OpenFOAM/v2006-foss-2020a

[removed most of the output here for clarity]

  Where:
   L:        Module is loaded
   Aliases:  Aliases exist: foo/1.2.3 (1.2) means that "module load foo/1.2"
             will load foo/1.2.3
   D:        Default Module

Use "module spider" to find all possible modules and extensions.
Use "module keyword key1 key2 ..." to search for all possible modules matching
any of the "keys".</code></pre>
</div>
<div id="utilizzo-dei-moduli-software-negli-script" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="utilizzo-dei-moduli-software-negli-script" class="callout-inner">
<h3 class="callout-title">Utilizzo dei moduli software negli script</h3>
<div class="callout-content">
<p>Creare un lavoro in grado di eseguire <code>python3 --version</code>.
Ricordate che per impostazione predefinita non viene caricato alcun
software! Eseguire un lavoro è come accedere al sistema (non si deve
dare per scontato che un modulo caricato sul nodo di login sia caricato
su un nodo di calcolo).</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Soluzione
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] nano python-module.sh</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] cat python-module.sh</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>#!/bin/bash
#SBATCH
r config$sched$comment` -t 00:00:30

module load Python

python3 --version</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] sbatch  python-module.sh</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Carica il software con <code>module load softwareName</code>.</li>
<li>Scarica il software con <code>module unload</code>
</li>
<li>Il sistema dei moduli gestisce automaticamente le versioni del
software e i conflitti tra i pacchetti.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-16-transferring-files"><p>Content from <a href="16-transferring-files.html">Trasferimento di file con computer remoti</a></p>
<hr>
<p>Last updated on 2025-03-23 |

        <a href="https://github.com/ocaisa/probable-pancake/edit/main/episodes/16-transferring-files.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 30 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>Come si trasferiscono i file al (e dal) cluster?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Trasferimento di file da e verso un cluster di calcolo.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Eseguire il lavoro su un computer remoto non è molto utile se non si
possono ottenere file da o verso il cluster. Esistono diverse opzioni
per trasferire i dati tra le risorse di calcolo utilizzando le utility
CLI e GUI, alcune delle quali verranno trattate.</p>
<section><h2 class="section-heading" id="scaricare-i-file-delle-lezioni-da-internet">Scaricare i file delle lezioni da Internet<a class="anchor" aria-label="anchor" href="#scaricare-i-file-delle-lezioni-da-internet"></a>
</h2>
<hr class="half-width">
<p>Uno dei modi più semplici per scaricare i file è usare
<code>curl</code> o <code>wget</code>. Uno di questi è solitamente
installato nella maggior parte delle shell di Linux, nel terminale di
Mac OS e in GitBash. Qualsiasi file che può essere scaricato nel browser
web attraverso un link diretto può essere scaricato usando
<code>curl</code> o <code>wget</code>. Si tratta di un modo rapido per
scaricare insiemi di dati o codice sorgente. La sintassi di questi
comandi è</p>
<ul>
<li><code>wget [-O new_name] https://some/link/to/a/file</code></li>
<li><code>curl [-o new_name] https://some/link/to/a/file</code></li>
</ul>
<p>provate a scaricare del materiale che useremo in seguito, da un
terminale sulla vostra macchina locale, usando l’URL della base di
codice corrente:</p>
<p><a href="https://github.com/hpc-carpentry/amdahl/tarball/main" class="external-link uri">https://github.com/hpc-carpentry/amdahl/tarball/main</a></p>
<div id="scarica-il-tarball" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="scarica-il-tarball" class="callout-inner">
<h3 class="callout-title">Scarica il “Tarball”</h3>
<div class="callout-content">
<p>La parola “tarball” nell’URL di cui sopra si riferisce a un formato
di archivio compresso comunemente usato su Linux, che è il sistema
operativo su cui gira la maggior parte dei cluster HPC. Un tarball è
molto simile a un file <code>.zip</code>. L’estensione effettiva del
file è <code>.tar.gz</code>, che riflette il processo in due fasi
utilizzato per creare il file: i file o le cartelle vengono uniti in un
unico file utilizzando <code>tar</code>, che viene poi compresso
utilizzando <code>gzip</code>, quindi l’estensione del file è
“tar-dot-g-z” È una parola lunga, quindi spesso si dice “il tarball
<em>xyz</em>”.</p>
<p>si può anche vedere l’estensione <code>.tgz</code>, che è solo
un’abbreviazione di <code>.tar.gz</code>.</p>
<p>Per impostazione predefinita, <code>curl</code> e <code>wget</code>
scaricano i file con lo stesso nome dell’URL: in questo caso,
<code>main</code>. Usare uno dei comandi precedenti per salvare il
tarball come <code>amdahl.tar.gz</code>.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Comandi wget e curl
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> wget <span class="at">-O</span> amdahl.tar.gz https://github.com/hpc-carpentry/amdahl/tarball/main</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> curl <span class="at">-o</span> amdahl.tar.gz <span class="at">-L</span> https://github.com/hpc-carpentry/amdahl/tarball/main</span></code></pre>
</div>
<p>L’opzione <code>-L</code> di <code>curl</code> indica di seguire i
reindirizzamenti URL (cosa che <code>wget</code> fa di default).</p>
</div>
</div>
</div>
</div>
<p>dopo aver scaricato il file, usare <code>ls</code> per vederlo nella
propria directory di lavoro:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> ls</span></code></pre>
</div>
</section><section><h2 class="section-heading" id="archiviazione-dei-file">Archiviazione dei file<a class="anchor" aria-label="anchor" href="#archiviazione-dei-file"></a>
</h2>
<hr class="half-width">
<p>Una delle maggiori sfide che spesso ci troviamo ad affrontare quando
trasferiamo dati tra sistemi HPC remoti è quella di un gran numero di
file. Il trasferimento di ogni singolo file comporta un sovraccarico e
quando si trasferisce un gran numero di file questi sovraccarichi si
combinano per rallentare notevolmente i trasferimenti.</p>
<p>La soluzione a questo problema è quella di <em>archiviare</em> più
file in un numero minore di file più grandi prima di trasferire i dati
per migliorare l’efficienza del trasferimento. A volte si combina
l’archiviazione con la <em>compressione</em> per ridurre la quantità di
dati da trasferire e quindi velocizzare il trasferimento. Il comando di
archiviazione più comune che si usa su un cluster HPC (Linux) è
<code>tar</code>.</p>
<p><code>tar</code> può essere usato per combinare file e cartelle in un
unico file di archivio e, facoltativamente, comprimere il risultato.
Osserviamo il file scaricato dal sito della lezione,
<code>amdahl.tar.gz</code>.</p>
<p>La parte <code>.gz</code> sta per <em>gzip</em>, che è una libreria
di compressione. È comune (ma non necessario!) che questo tipo di file
possa essere interpretato leggendo il suo nome: sembra che qualcuno
abbia preso file e cartelle relativi a qualcosa chiamato “amdahl”, li
abbia impacchettati tutti in un singolo file con <code>tar</code>,
quindi abbia compresso l’archivio con <code>gzip</code> per risparmiare
spazio.</p>
<p>Vediamo se questo è il caso, <em>senza</em> scompattare il file.
<code>tar</code> stampa il “**testo del contenuto” con il flag
<code>-t</code>, per il file specificato con il flag <code>-f</code>
seguito dal nome del file. Si noti che è possibile concatenare i due
flag: scrivere <code>-t -f</code> è intercambiabile con scrivere
<code>-tf</code> insieme. Tuttavia, l’argomento che segue
<code>-f</code> deve essere un nome di file, quindi scrivere
<code>-ft</code> non funzionerà.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> tar <span class="at">-tf</span> amdahl.tar.gz</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="ex">hpc-carpentry-amdahl-46c9b4b/</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="ex">hpc-carpentry-amdahl-46c9b4b/.github/</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="ex">hpc-carpentry-amdahl-46c9b4b/.github/workflows/</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="ex">hpc-carpentry-amdahl-46c9b4b/.github/workflows/python-publish.yml</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="ex">hpc-carpentry-amdahl-46c9b4b/.gitignore</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="ex">hpc-carpentry-amdahl-46c9b4b/LICENSE</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="ex">hpc-carpentry-amdahl-46c9b4b/README.md</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="ex">hpc-carpentry-amdahl-46c9b4b/amdahl/</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="ex">hpc-carpentry-amdahl-46c9b4b/amdahl/__init__.py</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="ex">hpc-carpentry-amdahl-46c9b4b/amdahl/__main__.py</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="ex">hpc-carpentry-amdahl-46c9b4b/amdahl/amdahl.py</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="ex">hpc-carpentry-amdahl-46c9b4b/requirements.txt</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="ex">hpc-carpentry-amdahl-46c9b4b/setup.py</span></span></code></pre>
</div>
<p>Questo esempio di output mostra una cartella che contiene alcuni
file, dove <code>46c9b4b</code> è un hash di commit di 8 caratteri <a href="https://swcarpentry.github.io/git-novice/" class="external-link">git</a> che cambierà
quando il materiale sorgente verrà aggiornato.</p>
<p>Ora scompattiamo l’archivio. Eseguiremo <code>tar</code> con alcuni
flag comuni:</p>
<ul>
<li>
<code>-x</code> per estrarre l’archivio</li>
<li>
<code>-v</code> per un output <strong>v</strong>erboso</li>
<li>
<code>-z</code> per la compressione g<strong>z</strong>ip</li>
<li>
<code>-f «tarball»</code> per il file da scompattare</li>
</ul>
<div id="estrazione-dellarchivio" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="estrazione-dellarchivio" class="callout-inner">
<h3 class="callout-title">Estrazione dell’archivio</h3>
<div class="callout-content">
<p>Usando i flag di cui sopra, scompattare il tarball del codice
sorgente in una nuova directory chiamata “amdahl” usando
<code>tar</code>.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> tar <span class="at">-xvzf</span> amdahl.tar.gz</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>hpc-carpentry-amdahl-46c9b4b/
hpc-carpentry-amdahl-46c9b4b/.github/
hpc-carpentry-amdahl-46c9b4b/.github/workflows/
hpc-carpentry-amdahl-46c9b4b/.github/workflows/python-publish.yml
hpc-carpentry-amdahl-46c9b4b/.gitignore
hpc-carpentry-amdahl-46c9b4b/LICENSE
hpc-carpentry-amdahl-46c9b4b/README.md
hpc-carpentry-amdahl-46c9b4b/amdahl/
hpc-carpentry-amdahl-46c9b4b/amdahl/__init__.py
hpc-carpentry-amdahl-46c9b4b/amdahl/__main__.py
hpc-carpentry-amdahl-46c9b4b/amdahl/amdahl.py
hpc-carpentry-amdahl-46c9b4b/requirements.txt
hpc-carpentry-amdahl-46c9b4b/setup.py</code></pre>
</div>
<p>Si noti che non è stato necessario digitare <code>-x -v -z -f</code>,
grazie alla concatenazione dei flag, anche se il comando funziona in
modo identico in entrambi i casi, purché l’elenco concatenato termini
con <code>f</code>, perché la stringa successiva deve specificare il
nome del file da estrarre.</p>
</div>
</div>
</div>
<p>La cartella ha un nome infelice, quindi cambiamolo con qualcosa di
più comodo.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> mv hpc-carpentry-amdahl-46c9b4b amdahl</span></code></pre>
</div>
<p>Controllare la dimensione della directory estratta e confrontarla con
la dimensione del file compresso, usando <code>du</code> per
“<strong>d</strong>isk <strong>u</strong>sage”.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> du <span class="at">-sh</span> amdahl.tar.gz</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="ex">8.0K</span>     amdahl.tar.gz</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> du <span class="at">-sh</span> amdahl</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="ex">48K</span>    amdahl</span></code></pre>
</div>
<p>I file di testo (compreso il codice sorgente Python) si comprimono
bene: il “tarball” è un sesto della dimensione totale dei dati
grezzi!</p>
<p>Se si vuole invertire il processo - comprimere i dati grezzi invece
di estrarli - impostare un flag <code>c</code> invece di <code>x</code>,
impostare il nome del file di archivio e fornire una directory da
comprimere:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> tar <span class="at">-cvzf</span> compressed_code.tar.gz amdahl</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>amdahl/
amdahl/.github/
amdahl/.github/workflows/
amdahl/.github/workflows/python-publish.yml
amdahl/.gitignore
amdahl/LICENSE
amdahl/README.md
amdahl/amdahl/
amdahl/amdahl/__init__.py
amdahl/amdahl/__main__.py
amdahl/amdahl/amdahl.py
amdahl/requirements.txt
amdahl/setup.py</code></pre>
</div>
<p>Se si dà <code>amdahl.tar.gz</code> come nome del file nel comando
precedente, <code>tar</code> aggiornerà il tarball esistente con
qualsiasi modifica apportata ai file. Ciò significa aggiungere la nuova
cartella <code>amdahl</code> alla cartella <em>esistente</em>
(<code>hpc-carpentry-amdahl-46c9b4b</code>) all’interno del tarball,
raddoppiando le dimensioni dell’archivio!</p>
<div id="lavorare-con-windows" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="lavorare-con-windows" class="callout-inner">
<h3 class="callout-title">Lavorare con Windows</h3>
<div class="callout-content">
<p>Quando si trasferiscono file di testo da un sistema Windows a un
sistema Unix (Mac, Linux, BSD, Solaris, ecc.) questo può causare
problemi. Windows codifica i suoi file in modo leggermente diverso da
Unix e aggiunge un carattere extra a ogni riga.</p>
<p>In un sistema Unix, ogni riga di un file termina con un
<code>\n</code> (newline). Su Windows, ogni riga di un file termina con
un <code>\r\n</code> (ritorno a capo + newline). Questo a volte causa
problemi.</p>
<p>Sebbene la maggior parte dei linguaggi di programmazione e dei
software moderni gestisca questo problema correttamente, in alcuni rari
casi si può incorrere in un problema. La soluzione consiste nel
convertire un file dalla codifica Windows a quella Unix con il comando
<code>dos2unix</code>.</p>
<p>È possibile identificare se un file ha terminazioni di riga Windows
con <code>cat -A filename</code>. Un file con terminazioni di riga
Windows avrà <code>^M$</code> alla fine di ogni riga. Un file con
terminazioni di riga Unix avrà <code>$</code> alla fine di una riga.</p>
<p>Per convertire il file, basta eseguire
<code>dos2unix filename</code>. (Viceversa, per riconvertire il formato
Windows, si può eseguire <code>unix2dos filename</code>)</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="trasferimento-di-singoli-file-e-cartelle-con-scp">Trasferimento di singoli file e cartelle con <code>scp</code>
<a class="anchor" aria-label="anchor" href="#trasferimento-di-singoli-file-e-cartelle-con-scp"></a>
</h2>
<hr class="half-width">
<p>Per copiare un singolo file da o verso il cluster, si può usare
<code>scp</code> (“copia sicura”). La sintassi può essere un po’
complessa per i nuovi utenti, ma la spiegheremo. Il comando
<code>scp</code> è un parente del comando <code>ssh</code> che abbiamo
usato per accedere al sistema e può usare lo stesso meccanismo di
autenticazione a chiave pubblica.</p>
<p>per <em>caricare su</em> un altro computer, il comando modello è</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> scp local_file yourUsername@cluster.hpc-carpentry.org:remote_destination</span></code></pre>
</div>
<p>in cui <code>@</code> e <code>:</code> sono separatori di campo e
<code>remote_destination</code> è un percorso relativo alla vostra home
directory remota, o un nuovo nome di file se desiderate cambiarlo, o sia
un percorso relativo <em>e</em> un nuovo nome di file. Se non si ha in
mente una cartella specifica, si può omettere la
<code>remote_destination</code> e il file verrà copiato nella propria
home directory sul computer remoto (con il nome originale). Se si
include un <code>remote_destination</code>, si noti che <code>scp</code>
lo interpreta nello stesso modo in cui lo interpreta <code>cp</code>
quando si effettuano copie locali: se esiste ed è una cartella, il file
viene copiato all’interno della cartella; se esiste ed è un file, il
file viene sovrascritto con il contenuto di <code>local_file</code>; se
non esiste, si presume che sia un nome di file di destinazione per
<code>local_file</code>.</p>
<p>Carica il materiale della lezione nella tua home directory remota in
questo modo:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> scp amdahl.tar.gz yourUsername@cluster.hpc-carpentry.org:</span></code></pre>
</div>
<div id="perché-non-scaricare-direttamente-su-hpc-carpentrys-cloud-cluster" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="perché-non-scaricare-direttamente-su-hpc-carpentrys-cloud-cluster" class="callout-inner">
<h3 class="callout-title">Perché non scaricare direttamente su HPC Carpentry’s Cloud Cluster?</h3>
<div class="callout-content">
<p>La maggior parte dei cluster di computer sono protetti da Internet da
un <em>firewall</em>. Per una maggiore sicurezza, alcuni sono
configurati per consentire il traffico <em>in entrata</em>, ma non
<em>in uscita</em>. Ciò significa che un utente autenticato può inviare
un file a un computer del cluster, ma un computer del cluster non può
recuperare i file dal computer di un utente o da Internet.</p>
<p>provare a scaricare direttamente il file. Si noti che potrebbe
fallire, ma va bene così!</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  Comandi
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> ssh yourUsername@cluster.hpc-carpentry.org</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] wget <span class="at">-O</span> amdahl.tar.gz https://github.com/hpc-carpentry/amdahl/tarball/main</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] curl <span class="at">-o</span> amdahl.tar.gz https://github.com/hpc-carpentry/amdahl/tarball/main</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="perché-non-scaricare-direttamente-su-hpc-carpentrys-cloud-cluster" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="perché-non-scaricare-direttamente-su-hpc-carpentrys-cloud-cluster" class="callout-inner">
<h3 class="callout-title">Perché non scaricare direttamente su HPC
Carpentry’s Cloud Cluster?<em> (continued)</em>
</h3>
<div class="callout-content">
<p>ha funzionato? Se no, che cosa ci dice l’output del terminale su ciò
che è successo?</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="trasferimento-di-una-directory">Trasferimento di una directory<a class="anchor" aria-label="anchor" href="#trasferimento-di-una-directory"></a>
</h2>
<hr class="half-width">
<p>Per trasferire un’intera directory, aggiungiamo il flag
<code>-r</code> per “<strong>r</strong>ecursive”: copia l’elemento
specificato, e ogni elemento sotto di esso, e ogni elemento sotto di
esso… fino a raggiungere il fondo dell’albero delle directory con radice
nel nome della cartella fornito.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> scp <span class="at">-r</span> amdahl yourUsername@cluster.hpc-carpentry.org:</span></code></pre>
</div>
<div id="attenzione" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="attenzione" class="callout-inner">
<h3 class="callout-title">Attenzione</h3>
<div class="callout-content">
<p>Per una directory di grandi dimensioni, sia in termini di dimensioni
che di numero di file, la copia con <code>-r</code> può richiedere molto
tempo.</p>
</div>
</div>
</div>
<p>Quando si usa <code>scp</code>, si può notare che un <code>:</code>
segue <em>sempre</em> il nome del computer remoto. Una stringa
<em>dopo</em> la <code>:</code> specifica la directory remota in cui si
desidera trasferire il file o la cartella, compreso un nuovo nome se si
desidera rinominare il materiale remoto. Se si lascia questo campo
vuoto, per impostazione predefinita, <code>scp</code> è la propria home
directory e il nome del materiale locale da trasferire.</p>
<p>Nei computer Linux, <code>/</code> è il separatore nei percorsi di
file o directory. Un percorso che inizia con un <code>/</code> è detto
<em>assoluto</em>, poiché non può esserci nulla al di sopra della radice
<code>/</code>. Un percorso che non inizia con <code>/</code> è detto
<em>relativo</em>, poiché non è ancorato alla radice.</p>
<p>Se si vuole caricare un file in una posizione all’interno della
propria home directory, cosa che accade spesso, non è necessario un
<code>/</code>. Dopo il <code>:</code>, si può digitare il percorso di
destinazione relativo alla propria home directory. Se la propria home
directory <em>è</em> la destinazione, si può lasciare il campo della
destinazione vuoto, oppure digitare <code>~</code> – l’abbreviazione
della propria home directory – per completezza.</p>
<p>Con <code>scp</code>, una barra tracciante sulla directory di
destinazione è opzionale e non ha alcun effetto. Il trattino sulla
directory di origine è importante per altri comandi, come
<code>rsync</code>.</p>
<div id="nota-su-rsync" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="nota-su-rsync" class="callout-inner">
<h3 class="callout-title">Nota su <code>rsync</code>
</h3>
<div class="callout-content">
<p>Man mano che si acquisisce esperienza nel trasferimento di file, il
comando <code>scp</code> può risultare limitante. L’utilità <a href="https://rsync.samba.org/" class="external-link">rsync</a> fornisce funzioni avanzate per
il trasferimento di file ed è tipicamente più veloce sia di
<code>scp</code> che di <code>sftp</code> (vedi sotto). È
particolarmente utile per trasferire file di grandi dimensioni e/o
numerosi e per sincronizzare il contenuto delle cartelle tra
computer.</p>
<p>la sintassi è simile a quella di <code>scp</code>. Per trasferire
<em>a</em> un altro computer con le opzioni comunemente usate:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> rsync <span class="at">-avP</span> amdahl.tar.gz yourUsername@cluster.hpc-carpentry.org:</span></code></pre>
</div>
<p>Le opzioni sono:</p>
<ul>
<li>
<code>-a</code> (<strong>un</strong>archivio) per conservare i
timestamp dei file, i permessi e le cartelle, tra le altre cose; implica
la ricorsione</li>
<li>
<code>-v</code> (<strong>v</strong>erbose) per ottenere un output
verboso che aiuti a monitorare il trasferimento</li>
<li>
<code>-P</code> (parziale/progresso) per preservare i file
parzialmente trasferiti in caso di interruzione e per visualizzare il
progresso del trasferimento.</li>
</ul>
<p>Per copiare ricorsivamente una directory, si possono usare le stesse
opzioni:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> rsync <span class="at">-avP</span> amdahl yourUsername@cluster.hpc-carpentry.org:~/</span></code></pre>
</div>
<p>così come è scritto, la directory locale e il suo contenuto si
trovano sotto la propria home directory sul sistema remoto. Se
all’origine viene aggiunto un trattino, non verrà creata una nuova
directory corrispondente alla directory trasferita e il contenuto della
directory di origine verrà copiato direttamente nella directory di
destinazione.</p>
<p>Per scaricare un file, basta cambiare la sorgente e la
destinazione:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> rsync <span class="at">-avP</span> yourUsername@cluster.hpc-carpentry.org:amdahl ./</span></code></pre>
</div>
</div>
</div>
</div>
<p>I trasferimenti di file che utilizzano sia <code>scp</code> che
<code>rsync</code> utilizzano SSH per crittografare i dati inviati
attraverso la rete. Quindi, se ci si può connettere tramite SSH, si
potranno trasferire i file. Per impostazione predefinita, SSH utilizza
la porta 22 della rete. Se è in uso una porta SSH personalizzata, è
necessario specificarla usando il flag appropriato, spesso
<code>-p</code>, <code>-P</code> o <code>--port</code>. Controllare
<code>--help</code> o la pagina <code>man</code> se non si è sicuri.</p>
<div id="cambia-la-porta-di-rsync" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="cambia-la-porta-di-rsync" class="callout-inner">
<h3 class="callout-title">Cambia la porta di Rsync</h3>
<div class="callout-content">
<p>Supponiamo di dover connettere <code>rsync</code> attraverso la porta
768 invece che 22. Come modificheremmo questo comando?</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> rsync amdahl.tar.gz yourUsername@cluster.hpc-carpentry.org:</span></code></pre>
</div>
<p><em>Consiglio:</em> controllate la pagina <code>man</code> o “help”
per <code>rsync</code>.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  Soluzione
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> man rsync</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> rsync <span class="at">--help</span> <span class="kw">|</span> <span class="fu">grep</span> port</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>     <span class="ex">--port=PORT</span>             specify double-colon alternate port number</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a><span class="ex">See</span> http://rsync.samba.org/ for updates, bug reports, and answers</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> rsync <span class="at">--port</span><span class="op">=</span>768 amdahl.tar.gz yourUsername@cluster.hpc-carpentry.org:</span></code></pre>
</div>
<p>(Si noti che questo comando fallirà, poiché la porta corretta in
questo caso è quella predefinita: 22)</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="trasferimento-interattivo-di-file-con-filezilla">Trasferimento interattivo di file con FileZilla<a class="anchor" aria-label="anchor" href="#trasferimento-interattivo-di-file-con-filezilla"></a>
</h2>
<hr class="half-width">
<p>FileZilla è un client multipiattaforma per scaricare e caricare file
da e verso un computer remoto. È assolutamente infallibile e funziona
sempre abbastanza bene. Utilizza il protocollo <code>sftp</code>. Per
saperne di più sull’uso del protocollo <code>sftp</code> nella riga di
comando, consultare la [discussione della lezione]
(../learning/discuss.md).</p>
<p>Scaricare e installare il client FileZilla da <a href="https://filezilla-project.org" class="external-link uri">https://filezilla-project.org</a>. Dopo l’installazione e
l’apertura del programma, dovrebbe apparire una finestra con un browser
di file del sistema locale sul lato sinistro dello schermo. Quando ci si
connette al cluster, i file del cluster appariranno sul lato destro.</p>
<p>Per connettersi al cluster, è sufficiente inserire le proprie
credenziali nella parte superiore dello schermo:</p>
<ul>
<li>Host: <code>sftp://cluster.hpc-carpentry.org</code>
</li>
<li>Utente: il nome utente del cluster</li>
<li>Password: La password del cluster</li>
<li>Porta: (lasciare vuoto per usare la porta predefinita)</li>
</ul>
<p>premere “Quickconnect” per connettersi. I file remoti dovrebbero
apparire sul lato destro dello schermo. È possibile trascinare i file
tra il lato sinistro (locale) e quello destro (remoto) dello schermo per
trasferirli.</p>
<p>Infine, se si devono spostare file di grandi dimensioni (tipicamente
più grandi di un gigabyte) da un computer remoto a un altro computer
remoto, si deve accedere con SSH al computer che ospita i file e usare
<code>scp</code> o <code>rsync</code> per trasferirli all’altro. Questo
sarà più efficiente rispetto all’uso di FileZilla (o di applicazioni
simili) che copierebbe dalla sorgente al computer locale e poi al
computer di destinazione.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>
<code>wget</code> e <code>curl -O</code> scaricano un file da
Internet.</li>
<li>
<code>scp</code> e <code>rsync</code> trasferiscono i file da e
verso il computer.</li>
<li>È possibile utilizzare un client SFTP come FileZilla per trasferire
i file attraverso un’interfaccia grafica.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-17-parallel"><p>Content from <a href="17-parallel.html">Esecuzione di un lavoro parallelo</a></p>
<hr>
<p>Last updated on 2025-03-23 |

        <a href="https://github.com/ocaisa/probable-pancake/edit/main/episodes/17-parallel.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 90 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>Come si esegue un’attività in parallelo?</li>
<li>Quali vantaggi derivano dall’esecuzione parallela?</li>
<li>Quali sono i limiti dei guadagni derivanti dall’esecuzione in
parallelo?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Installare un pacchetto Python utilizzando <code>pip</code>
</li>
<li>Preparare uno script di invio del lavoro per l’eseguibile
parallelo.</li>
<li>Avvio di lavori con esecuzione parallela.</li>
<li>Registrare e riassumere i tempi e la precisione dei lavori.</li>
<li>Descrivere la relazione tra parallelismo dei lavori e
prestazioni.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Ora abbiamo gli strumenti necessari per eseguire un lavoro
multiprocessore. Si tratta di un aspetto molto importante dei sistemi
HPC, poiché il parallelismo è uno degli strumenti principali di cui
disponiamo per migliorare le prestazioni delle attività di calcolo.</p>
<p>Se si è disconnessi, accedere nuovamente al cluster.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> ssh yourUsername@cluster.hpc-carpentry.org</span></code></pre>
</div>
<section><h2 class="section-heading" id="installare-il-programma-amdahl">Installare il programma Amdahl<a class="anchor" aria-label="anchor" href="#installare-il-programma-amdahl"></a>
</h2>
<hr class="half-width">
<p>Con il codice sorgente di Amdahl sul cluster, possiamo installarlo,
il che ci darà accesso all’eseguibile <code>amdahl</code>. Spostarsi
nella directory estratta, quindi usare il Package Installer for Python,
o <code>pip</code>, per installarlo nella propria home directory
(“utente”):</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] cd amdahl</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] python3 <span class="at">-m</span> pip install <span class="at">--user</span> .</span></code></pre>
</div>
<div id="amdahl-è-un-codice-python" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="amdahl-è-un-codice-python" class="callout-inner">
<h3 class="callout-title">Amdahl è un codice Python</h3>
<div class="callout-content">
<p>Il programma Amdahl è scritto in Python e per installarlo o
utilizzarlo è necessario individuare l’eseguibile <code>python3</code>
sul nodo di accesso. Se non si riesce a trovarlo, provare a elencare i
moduli disponibili usando <code>module avail</code>, caricare quello
appropriato e riprovare il comando.</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="mpi-per-python">MPI per Python<a class="anchor" aria-label="anchor" href="#mpi-per-python"></a>
</h3>
<p>Il codice Amdahl ha una sola dipendenza: <strong>mpi4py</strong>. Se
non è già stato installato sul cluster, <code>pip</code> cercherà di
prelevare mpi4py da Internet e di installarlo per l’utente. Se ciò
fallisce a causa di un firewall unidirezionale, è necessario recuperare
mpi4py sulla propria macchina locale e caricarlo, proprio come abbiamo
fatto per Amdahl.</p>
<div id="recupero-e-caricamento-di-mpi4py" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="recupero-e-caricamento-di-mpi4py" class="callout-inner">
<h3 class="callout-title">Recupero e caricamento di
<code>mpi4py</code>
</h3>
<div class="callout-content">
<p>Se l’installazione di Amdahl non è riuscita perché non è stato
possibile installare mpi4py, recuperare il tarball da <a href="https://github.com/mpi4py/mpi4py/tarball/master" class="external-link uri">https://github.com/mpi4py/mpi4py/tarball/master</a> quindi
<code>rsync</code> sul cluster, estrarlo e installarlo:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> wget <span class="at">-O</span> mpi4py.tar.gz https://github.com/mpi4py/mpi4py/releases/download/3.1.4/mpi4py-3.1.4.tar.gz</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> scp mpi4py.tar.gz yourUsername@cluster.hpc-carpentry.org:</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> rsync <span class="at">-avP</span> mpi4py.tar.gz yourUsername@cluster.hpc-carpentry.org:</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">[you@laptop:~]$</span> ssh yourUsername@cluster.hpc-carpentry.org</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] tar <span class="at">-xvzf</span> mpi4py.tar.gz  <span class="co"># extract the archive</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] mv mpi4py<span class="pp">*</span> mpi4py        <span class="co"># rename the directory</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] cd mpi4py</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] python3 <span class="at">-m</span> pip install <span class="at">--user</span> .</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] cd ../amdahl</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] python3 <span class="at">-m</span> pip install <span class="at">--user</span> .</span></code></pre>
</div>
</div>
</div>
</div>
<div id="se-pip-solleva-un-avviso" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="se-pip-solleva-un-avviso" class="callout-inner">
<h3 class="callout-title">Se <code>pip</code> solleva un avviso…</h3>
<div class="callout-content">
<p><code>pip</code> potrebbe avvertire che i binari del pacchetto utente
non sono presenti nel PATH.</p>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>WARNING: The script amdahl is installed in "${HOME}/.local/bin" which is
not on PATH. Consider adding this directory to PATH or, if you prefer to
suppress this warning, use --no-warn-script-location.</code></pre>
</div>
<p>Per verificare se questo avviso rappresenta un problema, utilizzare
<code>which</code> per cercare il programma <code>amdahl</code>:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] which amdahl</span></code></pre>
</div>
<p>Se il comando non restituisce alcun risultato, visualizzando un nuovo
prompt, significa che il file <code>amdahl</code> non è stato trovato. È
necessario aggiornare la variabile d’ambiente denominata
<code>PATH</code> per includere la cartella mancante. Modificare il file
di configurazione della shell come segue, quindi disconnettersi dal
cluster e riaccenderlo in modo che abbia effetto.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] nano ~/.bashrc</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] tail ~/.bashrc</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>export PATH=${PATH}:${HOME}/.local/bin</code></pre>
</div>
<p>Dopo aver effettuato il login a cluster.hpc-carpentry.org,
<code>which</code> dovrebbe essere in grado di trovare
<code>amdahl</code> senza difficoltà. Se si è dovuto caricare un modulo
Python, caricarlo di nuovo.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="aiuto">Aiuto!<a class="anchor" aria-label="anchor" href="#aiuto"></a>
</h2>
<hr class="half-width">
<p>Molti programmi a riga di comando includono un messaggio di “aiuto”.
Provatelo con <code>amdahl</code>:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] amdahl <span class="at">--help</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>usage: amdahl [-h] [-p [PARALLEL_PROPORTION]] [-w [WORK_SECONDS]] [-t] [-e] [-j [JITTER_PROPORTION]]

optional arguments:
  -h, --help            show this help message and exit
  -p [PARALLEL_PROPORTION], --parallel-proportion [PARALLEL_PROPORTION]
                        Parallel proportion: a float between 0 and 1
  -w [WORK_SECONDS], --work-seconds [WORK_SECONDS]
                        Total seconds of workload: an integer greater than 0
  -t, --terse           Format output as a machine-readable object for easier analysis
  -e, --exact           Exactly match requested timing by disabling random jitter
  -j [JITTER_PROPORTION], --jitter-proportion [JITTER_PROPORTION]
                        Random jitter: a float between -1 and +1</code></pre>
</div>
<p>Questo messaggio non ci dice molto su ciò che il programma
<em>fa</em>, ma ci dice i flag importanti che potremmo voler usare
quando lo lanciamo.</p>
</section><section><h2 class="section-heading" id="esecuzione-del-lavoro-su-un-nodo-di-calcolo">Esecuzione del lavoro su un nodo di calcolo<a class="anchor" aria-label="anchor" href="#esecuzione-del-lavoro-su-un-nodo-di-calcolo"></a>
</h2>
<hr class="half-width">
<p>Creare un file di presentazione, richiedere un task su un singolo
nodo e lanciarlo.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] nano serial-job.sh</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] cat serial-job.sh</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="co">#SBATCH -J solo-job</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="co">#SBATCH -p cpubase_bycore_b1</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="co">#SBATCH -N 1</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="co">#SBATCH -n 1</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="co"># Load the computing environment we need</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="ex">module</span> load Python</span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="co"># Execute the task</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="ex">amdahl</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] sbatch serial-job.sh</span></code></pre>
</div>
<p>Come in precedenza, utilizzare i comandi di stato Slurm per
verificare se il lavoro è in esecuzione e quando termina:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] squeue <span class="at">-u</span> yourUsername</span></code></pre>
</div>
<p>Usare <code>ls</code> per localizzare il file di output. Il flag
<code>-t</code> ordina in ordine cronologico inverso: prima il più
recente. Qual era l’output?</p>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div>
  Lettura dell’output del lavoro
  </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" data-bs-parent="#accordionSpoiler1" aria-labelledby="headingSpoiler1">
<div class="accordion-body">
<p>L’output del cluster deve essere scritto in un file nella cartella da
cui è stato lanciato il lavoro. Ad esempio,</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] ls <span class="at">-t</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>slurm-347087.out  serial-job.sh  amdahl  README.md  LICENSE.txt</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] cat slurm-347087.out</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Doing 30.000 seconds of 'work' on 1 processor,
which should take 30.000 seconds with 0.850 parallel proportion of the workload.

  Hello, World! I am process 0 of 1 on smnode1. I will do all the serial 'work' for 4.500 seconds.
  Hello, World! I am process 0 of 1 on smnode1. I will do parallel 'work' for 25.500 seconds.

Total execution time (according to rank 0): 30.033 seconds</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Come abbiamo visto in precedenza, due dei flag del programma
<code>amdahl</code> impostano la quantità di lavoro e la proporzione di
tale lavoro che è di natura parallela. In base all’output, possiamo
vedere che il codice utilizza un valore predefinito di 30 secondi di
lavoro parallelo all’85%. Il programma ha funzionato per poco più di 30
secondi in totale e, se facciamo i conti, è vero che il 15% è stato
contrassegnato come ‘seriale’ e l’85% come ‘parallelo’.</p>
<p>Poiché abbiamo dato al lavoro una sola CPU, questo lavoro non è stato
veramente parallelo: lo stesso processore ha eseguito il lavoro
‘seriale’ per 4,5 secondi, poi la parte ‘parallela’ per 25,5 secondi, e
non è stato risparmiato tempo. Il cluster può fare di meglio, se lo
chiediamo.</p>
</section><section><h2 class="section-heading" id="esecuzione-del-lavoro-parallelo">Esecuzione del lavoro parallelo<a class="anchor" aria-label="anchor" href="#esecuzione-del-lavoro-parallelo"></a>
</h2>
<hr class="half-width">
<p>Il programma <code>amdahl</code> utilizza la Message Passing
Interface (MPI) per il parallelismo, uno strumento comune nei sistemi
HPC.</p>
<div id="cosè-mpi" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="cosè-mpi" class="callout-inner">
<h3 class="callout-title">Cos’è MPI?</h3>
<div class="callout-content">
<p>L’interfaccia per il passaggio di messaggi è un insieme di strumenti
che consentono a più task in esecuzione simultanea di comunicare tra
loro. In genere, un singolo eseguibile viene eseguito più volte,
eventualmente su macchine diverse, e gli strumenti MPI vengono
utilizzati per informare ogni istanza dell’eseguibile sui suoi processi
fratelli e su quale istanza sia. MPI fornisce anche strumenti per
consentire la comunicazione tra le istanze per coordinare il lavoro,
scambiare informazioni su elementi dell’attività o trasferire dati.
Un’istanza MPI ha tipicamente una propria copia di tutte le variabili
locali.</p>
</div>
</div>
</div>
<p>Mentre gli eseguibili MPI-aware possono generalmente essere eseguiti
come programmi autonomi, per poter essere eseguiti in parallelo devono
utilizzare un <em>ambiente di esecuzione MPI</em>, che è
un’implementazione specifica dello <em>standard</em> MPI. Per attivare
l’ambiente MPI, il programma deve essere avviato con un comando come
<code>mpiexec</code> (o <code>mpirun</code>, o <code>srun</code>, ecc. a
seconda del run-time MPI da utilizzare), che garantirà l’inclusione del
supporto run-time appropriato per il parallelismo.</p>
<div id="argomenti-di-runtime-mpi" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="argomenti-di-runtime-mpi" class="callout-inner">
<h3 class="callout-title">Argomenti di runtime MPI</h3>
<div class="callout-content">
<p>Di per sé, comandi come <code>mpiexec</code> possono accettare molti
argomenti che specificano quante macchine parteciperanno all’esecuzione,
e potrebbero essere necessari se si desidera eseguire un programma MPI
da soli (ad esempio, sul proprio portatile). Nel contesto di un sistema
di accodamento, tuttavia, è frequente che il run-time MPI ottenga i
parametri necessari dal sistema di accodamento, esaminando le variabili
d’ambiente impostate al momento del lancio del lavoro.</p>
</div>
</div>
</div>
<p>Modifichiamo lo script del lavoro per richiedere più core e
utilizzare il run-time MPI.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] cp serial-job.sh parallel-job.sh</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] nano parallel-job.sh</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] cat parallel-job.sh</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="co">#SBATCH -J parallel-job</span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a><span class="co">#SBATCH -p cpubase_bycore_b1</span></span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a><span class="co">#SBATCH -N 1</span></span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a><span class="co">#SBATCH -n 4</span></span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a><span class="co"># Load the computing environment we need</span></span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a><span class="co"># (mpi4py and numpy are in SciPy-bundle)</span></span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a><span class="ex">module</span> load Python</span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a><span class="ex">module</span> load SciPy-bundle</span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a></span>
<span id="cb20-12"><a href="#cb20-12" tabindex="-1"></a><span class="co"># Execute the task</span></span>
<span id="cb20-13"><a href="#cb20-13" tabindex="-1"></a><span class="ex">mpiexec</span> amdahl</span></code></pre>
</div>
<p>Quindi inviare il lavoro. Si noti che il comando di invio non è
cambiato rispetto a come abbiamo inviato il lavoro seriale: tutte le
impostazioni parallele sono nel file batch anziché nella riga di
comando.</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] sbatch parallel-job.sh</span></code></pre>
</div>
<p>Come in precedenza, utilizzare i comandi di stato per verificare
l’esecuzione del lavoro.</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] ls <span class="at">-t</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>slurm-347178.out  parallel-job.sh  slurm-347087.out  serial-job.sh  amdahl  README.md  LICENSE.txt</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] cat slurm-347178.out</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Doing 30.000 seconds of 'work' on 4 processors,
which should take 10.875 seconds with 0.850 parallel proportion of the workload.

  Hello, World! I am process 0 of 4 on smnode1. I will do all the serial 'work' for 4.500 seconds.
  Hello, World! I am process 2 of 4 on smnode1. I will do parallel 'work' for 6.375 seconds.
  Hello, World! I am process 1 of 4 on smnode1. I will do parallel 'work' for 6.375 seconds.
  Hello, World! I am process 3 of 4 on smnode1. I will do parallel 'work' for 6.375 seconds.
  Hello, World! I am process 0 of 4 on smnode1. I will do parallel 'work' for 6.375 seconds.

Total execution time (according to rank 0): 10.888 seconds</code></pre>
</div>
<div id="è-4-volte-più-veloce" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="è-4-volte-più-veloce" class="callout-inner">
<h3 class="callout-title">È 4 volte più veloce?</h3>
<div class="callout-content">
<p>Il lavoro parallelo ha ricevuto 4 volte più processori del lavoro
seriale: significa che è stato completato in ¼ del tempo?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Soluzione
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>Il lavoro parallelo ha richiesto <em>meno</em> tempo: 11 secondi sono
meglio di 30! Ma è solo un miglioramento di 2,7 volte, non di 4
volte.</p>
<p>Guardate l’output del lavoro:</p>
<ul>
<li>Mentre il “processo 0” svolgeva il lavoro seriale, i processi da 1 a
3 svolgevano il lavoro parallelo.</li>
<li>Mentre il processo 0 ha recuperato il suo lavoro parallelo, gli
altri non hanno fatto nulla.</li>
</ul>
<p>Il processo 0 deve sempre terminare il suo compito seriale prima di
poter iniziare il lavoro parallelo. In questo modo si stabilisce un
limite inferiore alla quantità di tempo che questo lavoro richiederà,
indipendentemente dal numero di core.</p>
<p>Questo è il principio di base della <a href="https://en.wikipedia.org/wiki/Amdahl's_law" class="external-link">legge di
Amdahl</a>, che è un modo per prevedere miglioramenti nel tempo di
esecuzione per un carico di lavoro <strong>fisso</strong> che può essere
suddiviso ed eseguito in parallelo in una certa misura.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="quanto-migliora-le-prestazioni-lesecuzione-parallela">Quanto migliora le prestazioni l’esecuzione parallela?<a class="anchor" aria-label="anchor" href="#quanto-migliora-le-prestazioni-lesecuzione-parallela"></a>
</h2>
<hr class="half-width">
<p>In teoria, dividere un calcolo perfettamente parallelo tra <em>n</em>
processi MPI dovrebbe produrre una diminuzione del tempo di esecuzione
totale di un fattore <em>n</em>. Come abbiamo appena visto, i programmi
reali hanno bisogno di un po’ di tempo per far comunicare e coordinare i
processi MPI, e alcuni tipi di calcoli non possono essere suddivisi:
vengono eseguiti efficacemente solo su una singola CPU.</p>
<p>Inoltre, se i processi MPI operano su diverse CPU fisiche del
computer o su più nodi di calcolo, la comunicazione richiede ancora più
tempo di quello necessario quando tutti i processi operano su una
singola CPU.</p>
<p>In pratica, è comune valutare il parallelismo di un programma MPI
mediante</p>
<ul>
<li>esecuzione del programma su un intervallo di CPU,</li>
<li>registrazione del tempo di esecuzione per ogni esecuzione,</li>
<li>confrontando ogni tempo di esecuzione con il tempo di utilizzo di
una singola CPU.</li>
</ul>
<p>Poiché “di più è meglio” - il miglioramento è più facile da
interpretare dall’aumento di una certa quantità piuttosto che dalla sua
diminuzione - i confronti vengono fatti usando il fattore di
accelerazione <em>S</em>, che è calcolato come il tempo di esecuzione a
singola CPU diviso per il tempo di esecuzione a più CPU. Per un
programma perfettamente parallelo, un grafico dello speedup <em>S</em>
in funzione del numero di CPU <em>n</em> darebbe una linea retta,
<em>S</em> = <em>n</em>.</p>
<p>Eseguiamo un altro lavoro, per vedere quanto si avvicina a una linea
retta il nostro codice <code>amdahl</code>.</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] nano parallel-job.sh</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] cat parallel-job.sh</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a><span class="co">#SBATCH -J parallel-job</span></span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a><span class="co">#SBATCH -p cpubase_bycore_b1</span></span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a><span class="co">#SBATCH -N 1</span></span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a><span class="co">#SBATCH -n 8</span></span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" tabindex="-1"></a><span class="co"># Load the computing environment we need</span></span>
<span id="cb27-8"><a href="#cb27-8" tabindex="-1"></a><span class="co"># (mpi4py and numpy are in SciPy-bundle)</span></span>
<span id="cb27-9"><a href="#cb27-9" tabindex="-1"></a><span class="ex">module</span> load Python</span>
<span id="cb27-10"><a href="#cb27-10" tabindex="-1"></a><span class="ex">module</span> load SciPy-bundle</span>
<span id="cb27-11"><a href="#cb27-11" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" tabindex="-1"></a><span class="co"># Execute the task</span></span>
<span id="cb27-13"><a href="#cb27-13" tabindex="-1"></a><span class="ex">mpiexec</span> amdahl</span></code></pre>
</div>
<p>Quindi inviare il lavoro. Si noti che il comando di invio non è
cambiato rispetto a come abbiamo inviato il lavoro seriale: tutte le
impostazioni parallele sono nel file batch anziché nella riga di
comando.</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] sbatch parallel-job.sh</span></code></pre>
</div>
<p>Come in precedenza, utilizzare i comandi di stato per verificare
l’esecuzione del lavoro.</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] ls <span class="at">-t</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>slurm-347271.out  parallel-job.sh  slurm-347178.out  slurm-347087.out  serial-job.sh  amdahl  README.md  LICENSE.txt</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] cat slurm-347178.out</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>which should take 7.688 seconds with 0.850 parallel proportion of the workload.

  Hello, World! I am process 4 of 8 on smnode1. I will do parallel 'work' for 3.188 seconds.
  Hello, World! I am process 0 of 8 on smnode1. I will do all the serial 'work' for 4.500 seconds.
  Hello, World! I am process 2 of 8 on smnode1. I will do parallel 'work' for 3.188 seconds.
  Hello, World! I am process 1 of 8 on smnode1. I will do parallel 'work' for 3.188 seconds.
  Hello, World! I am process 3 of 8 on smnode1. I will do parallel 'work' for 3.188 seconds.
  Hello, World! I am process 5 of 8 on smnode1. I will do parallel 'work' for 3.188 seconds.
  Hello, World! I am process 6 of 8 on smnode1. I will do parallel 'work' for 3.188 seconds.
  Hello, World! I am process 7 of 8 on smnode1. I will do parallel 'work' for 3.188 seconds.
  Hello, World! I am process 0 of 8 on smnode1. I will do parallel 'work' for 3.188 seconds.

Total execution time (according to rank 0): 7.697 seconds</code></pre>
</div>
<div id="uscita-non-lineare" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="uscita-non-lineare" class="callout-inner">
<h3 class="callout-title">Uscita non lineare</h3>
<div class="callout-content">
<p>Quando abbiamo eseguito il lavoro con 4 lavoratori paralleli, il
lavoro seriale ha scritto il suo output per primo, poi i processi
paralleli hanno scritto il loro output, con il processo 0 che è arrivato
per primo e per ultimo.</p>
<p>Con 8 worker, questo non è il caso: poiché i worker paralleli
richiedono meno tempo del lavoro seriale, è difficile dire quale
processo scriverà per primo il suo output, tranne che <em>non</em> sarà
il processo 0!</p>
</div>
</div>
</div>
<p>Riassumiamo ora il tempo di esecuzione di ciascun lavoro:</p>
<table class="table">
<thead><tr class="header">
<th>Number of CPUs</th>
<th>Runtime (sec)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>30.033</td>
</tr>
<tr class="even">
<td>4</td>
<td>10.888</td>
</tr>
<tr class="odd">
<td>8</td>
<td>7.697</td>
</tr>
</tbody>
</table>
<p>Quindi, utilizzare la prima riga per calcolare gli speedup <span class="math inline">\(S\)</span>, utilizzando Python come calcolatore a
riga di comando e la formula</p>
<p><span class="math display">\[ S(t_{n}) = \frac{t_{1}}{t_{n}}
\]</span></p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] for n in 30.033 10.888 7.697<span class="kw">;</span> <span class="cf">do</span> <span class="ex">python3</span> <span class="at">-c</span> <span class="st">"print(30.033 / </span><span class="va">$n</span><span class="st">)"</span><span class="kw">;</span> <span class="cf">done</span></span></code></pre>
</div>
<table class="table">
<thead><tr class="header">
<th>Number of CPUs</th>
<th>Speedup</th>
<th>Ideal</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>1.0</td>
<td>1</td>
</tr>
<tr class="even">
<td>4</td>
<td>2.75</td>
<td>4</td>
</tr>
<tr class="odd">
<td>8</td>
<td>3.90</td>
<td>8</td>
</tr>
</tbody>
</table>
<p>I file di output del lavoro ci dicono che questo programma esegue
l’85% del suo lavoro in parallelo, lasciando il 15% all’esecuzione
seriale. Questo dato sembra ragionevolmente alto, ma il nostro rapido
studio dello speedup mostra che per ottenere uno speedup 4×, dobbiamo
usare 8 o 9 processori in parallelo. Nei programmi reali, il fattore di
velocizzazione è influenzato da</p>
<ul>
<li>Progettazione della CPU</li>
<li>rete di comunicazione tra i nodi di calcolo</li>
<li>Implementazioni della libreria MPI</li>
<li>dettagli del programma MPI stesso</li>
</ul>
<p>Utilizzando la legge di Amdahl, è possibile dimostrare che con questo
programma è <em>impossibile</em> raggiungere una velocità di 8 volte,
indipendentemente dal numero di processori disponibili. I dettagli di
questa analisi, con i risultati a supporto, sono lasciati per la
prossima lezione del workshop HPC Carpentry, <em>Flussi di lavoro
HPC</em>.</p>
<p>In un ambiente HPC si cerca di ridurre il tempo di esecuzione di
tutti i tipi di lavoro e MPI è un modo estremamente comune per combinare
decine, centinaia o migliaia di CPU nella risoluzione di un singolo
problema. Per saperne di più sulla parallelizzazione, vedere la lezione
[lezione parallela per principianti][lezione parallela per
principianti].</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>La programmazione parallela consente alle applicazioni di sfruttare
l’hardware parallelo.</li>
<li>Il sistema di accodamento facilita l’esecuzione di compiti
paralleli.</li>
<li>I miglioramenti delle prestazioni derivanti dall’esecuzione
parallela non hanno una scala lineare.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-18-resources"><p>Content from <a href="18-resources.html">Usare le risorse in modo efficace</a></p>
<hr>
<p>Last updated on 2025-03-23 |

        <a href="https://github.com/ocaisa/probable-pancake/edit/main/episodes/18-resources.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 30 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>Come posso rivedere i lavori passati?</li>
<li>Come posso utilizzare queste conoscenze per creare uno script di
invio più accurato?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Consultare le statistiche dei lavori.</li>
<li>Fare richieste di risorse più accurate negli script di lavoro in
base ai dati che descrivono le prestazioni passate.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Abbiamo toccato tutte le competenze necessarie per interagire con un
cluster HPC: accesso tramite SSH, caricamento di moduli software, invio
di lavori paralleli e ricerca dell’output. Ora impariamo a stimare
l’utilizzo delle risorse e perché potrebbe essere importante.</p>
<section><h2 class="section-heading" id="stima-delle-risorse-necessarie-con-lo-scheduler">Stima delle risorse necessarie con lo scheduler<a class="anchor" aria-label="anchor" href="#stima-delle-risorse-necessarie-con-lo-scheduler"></a>
</h2>
<hr class="half-width">
<p>Anche se prima abbiamo affrontato la richiesta di risorse allo
scheduler con il codice π, come facciamo a sapere di che tipo di risorse
avrà bisogno il software e la sua richiesta per ciascuna di esse? In
generale, a meno che la documentazione del software o le testimonianze
degli utenti non forniscano qualche idea, non sapremo di quanta memoria
o tempo di calcolo avrà bisogno un programma.</p>
<div id="leggi-la-documentazione" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="leggi-la-documentazione" class="callout-inner">
<h3 class="callout-title">Leggi la documentazione</h3>
<div class="callout-content">
<p>La maggior parte delle strutture HPC conserva la documentazione in
forma di wiki, sito web o documento inviato al momento della
registrazione di un account. Date un’occhiata a queste risorse e cercate
il software che intendete usare: qualcuno potrebbe aver scritto una
guida per ottenere il massimo da esso.</p>
</div>
</div>
</div>
<p>Un modo comodo per capire quali risorse sono necessarie perché un
lavoro venga eseguito con successo è quello di inviare un lavoro di
prova e poi chiedere allo scheduler il suo impatto usando
<code>sacct -u yourUsername</code>. Si può usare questa conoscenza per
impostare il lavoro successivo con una stima più precisa del suo carico
sul sistema. Una buona regola generale è quella di chiedere allo
schedulatore dal 20% al 30% di tempo e memoria in più rispetto a quanto
si prevede che il lavoro richieda. In questo modo si garantisce che
piccole fluttuazioni nel tempo di esecuzione o nell’uso della memoria
non comportino l’annullamento del lavoro da parte dello schedulatore.
Tenete presente che se chiedete troppo, il vostro lavoro potrebbe non
essere eseguito anche se le risorse disponibili sono sufficienti, perché
lo schedulatore aspetterà che i lavori degli altri finiscano e liberino
le risorse necessarie per soddisfare la vostra richiesta.</p>
</section><section><h2 class="section-heading" id="statistiche">Statistiche<a class="anchor" aria-label="anchor" href="#statistiche"></a>
</h2>
<hr class="half-width">
<p>Poiché abbiamo già inviato <code>amdahl</code> per l’esecuzione sul
cluster, possiamo interrogare lo scheduler per vedere quanto tempo ha
impiegato il nostro lavoro e quali risorse sono state utilizzate.
Useremo <code>sacct -u yourUsername</code> per ottenere le statistiche
su <code>parallel-job.sh</code>.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] sacct <span class="at">-u</span> yourUsername</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>       JobID    JobName  Partition    Account  AllocCPUS      State ExitCode
------------ ---------- ---------- ---------- ---------- ---------- --------
7               file.sh cpubase_b+ def-spons+          1  COMPLETED      0:0
7.batch           batch            def-spons+          1  COMPLETED      0:0
7.extern         extern            def-spons+          1  COMPLETED      0:0
8               file.sh cpubase_b+ def-spons+          1  COMPLETED      0:0
8.batch           batch            def-spons+          1  COMPLETED      0:0
8.extern         extern            def-spons+          1  COMPLETED      0:0
9            example-j+ cpubase_b+ def-spons+          1  COMPLETED      0:0
9.batch           batch            def-spons+          1  COMPLETED      0:0
9.extern         extern            def-spons+          1  COMPLETED      0:0</code></pre>
</div>
<p>Questo mostra tutti i lavori eseguiti oggi (si noti che ci sono più
voci per ogni lavoro). Per ottenere informazioni su un lavoro specifico
(ad esempio, 347087), si cambia leggermente il comando.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] sacct <span class="at">-u</span> yourUsername <span class="at">-l</span> <span class="at">-j</span> 347087</span></code></pre>
</div>
<p>mostrerà molte informazioni; in effetti, ogni singola informazione
raccolta sul lavoro dallo schedulatore apparirà qui. Può essere utile
reindirizzare queste informazioni a <code>less</code> per facilitarne la
visualizzazione (usare i tasti freccia sinistra e destra per scorrere i
campi).</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">[yourUsername@login1</span> ~] sacct <span class="at">-u</span> yourUsername <span class="at">-l</span> <span class="at">-j</span> 347087 <span class="kw">|</span> <span class="fu">less</span> <span class="at">-S</span></span></code></pre>
</div>
<div id="discussione" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="discussione" class="callout-inner">
<h3 class="callout-title">Discussione</h3>
<div class="callout-content">
<p>Questa vista può aiutare a confrontare la quantità di tempo richiesta
ed effettivamente utilizzata, la durata della permanenza nella coda
prima del lancio e l’impronta di memoria sui nodi di calcolo.</p>
<p>Quanto sono state accurate le nostre stime?</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="miglioramento-delle-richieste-di-risorse">Miglioramento delle richieste di risorse<a class="anchor" aria-label="anchor" href="#miglioramento-delle-richieste-di-risorse"></a>
</h2>
<hr class="half-width">
<p>Dalla cronologia dei lavori, vediamo che i lavori <code>amdahl</code>
hanno terminato l’esecuzione in pochi minuti, una volta spediti. La
stima del tempo fornita nello script del lavoro era troppo lunga! Questo
rende più difficile per il sistema di accodamento stimare con precisione
quando le risorse si libereranno per altri lavori. In pratica, questo
significa che il sistema di accodamento aspetta a inviare il nostro
lavoro <code>amdahl</code> fino a quando non si apre l’intera fascia
oraria richiesta, invece di “intrufolarsi” in una finestra molto più
breve in cui il lavoro potrebbe effettivamente terminare. Specificando
con maggiore precisione il tempo di esecuzione previsto nello script di
invio, si può contribuire ad alleviare la congestione del cluster e a
far sì che il lavoro venga inviato prima.</p>
<div id="restringere-la-stima-del-tempo" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="restringere-la-stima-del-tempo" class="callout-inner">
<h3 class="callout-title">Restringere la stima del tempo</h3>
<div class="callout-content">
<p>Modificare <code>parallel_job.sh</code> per impostare una stima
migliore del tempo. Quanto ci si può avvicinare?</p>
<p>Suggerimento: usare <code>-t</code>.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Soluzione
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>La riga seguente dice a Slurm che il nostro lavoro deve finire entro
2 minuti:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co">#SBATCH -t 00:02:00</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Job script accurati aiutano il sistema di accodamento ad allocare in
modo efficiente le risorse condivise.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-19-responsibility"><p>Content from <a href="19-responsibility.html">Usare le risorse condivise in modo responsabile</a></p>
<hr>
<p>Last updated on 2025-03-23 |

        <a href="https://github.com/ocaisa/probable-pancake/edit/main/episodes/19-responsibility.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 20 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>Come posso essere un utente responsabile?</li>
<li>Come posso proteggere i miei dati?</li>
<li>Come posso ottenere grandi quantità di dati da un sistema HPC?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Descrivere come le azioni di un singolo utente possono influenzare
l’esperienza degli altri su un sistema condiviso.</li>
<li>Discutere il comportamento di un premuroso cittadino del sistema
condiviso.</li>
<li>Spiegare l’importanza del backup dei dati critici.</li>
<li>Descrivere le sfide legate al trasferimento di grandi quantità di
dati dai sistemi HPC.</li>
<li>Convertire molti file in un singolo file di archivio usando
tar.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Una delle principali differenze tra l’uso di risorse HPC remote e il
proprio sistema (ad esempio il portatile) è che le risorse remote sono
condivise. Il numero di utenti tra i quali la risorsa è condivisa varia
da sistema a sistema, ma è improbabile che siate l’unico utente connesso
o che utilizzi un sistema di questo tipo.</p>
<p>L’uso diffuso di sistemi di schedulazione in cui gli utenti inviano
lavori su risorse HPC è un risultato naturale della natura condivisa di
queste risorse. Ci sono altre cose che, in quanto membro integerrimo
della comunità, dovete considerare.</p>
<section><h2 class="section-heading" id="sii-gentile-con-i-nodi-di-accesso">Sii gentile con i nodi di accesso<a class="anchor" aria-label="anchor" href="#sii-gentile-con-i-nodi-di-accesso"></a>
</h2>
<hr class="half-width">
<p>Il nodo di login è spesso impegnato a gestire tutti gli utenti
connessi, a creare e modificare file e a compilare software. Se la
macchina esaurisce la memoria o la capacità di elaborazione, diventa
molto lenta e inutilizzabile per tutti. Sebbene la macchina sia
destinata a essere utilizzata, assicuratevi di farlo in modo
responsabile, ovvero senza influire negativamente sull’esperienza degli
altri utenti.</p>
<p>I nodi di accesso sono sempre il posto giusto per lanciare i lavori.
Le politiche dei cluster variano, ma possono anche essere usati per
provare i flussi di lavoro e, in alcuni casi, possono ospitare strumenti
avanzati di debug o di sviluppo specifici per il cluster. Il cluster può
avere moduli che devono essere caricati, magari in un certo ordine, e
percorsi o versioni di librerie che differiscono dal vostro portatile;
fare un test interattivo sul nodo principale è un modo rapido e
affidabile per scoprire e risolvere questi problemi.</p>
<div id="i-nodi-di-login-sono-una-risorsa-condivisa" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="i-nodi-di-login-sono-una-risorsa-condivisa" class="callout-inner">
<h3 class="callout-title">I nodi di login sono una risorsa condivisa</h3>
<div class="callout-content">
<p>Ricordate che il nodo di login è condiviso con tutti gli altri utenti
e le vostre azioni potrebbero causare problemi ad altre persone. Pensate
bene alle potenziali implicazioni dell’emissione di comandi che possono
utilizzare grandi quantità di risorse.</p>
<p>Non siete sicuri? Chiedete al vostro amichevole amministratore di
sistema (“sysadmin”) se la cosa che state pensando di fare è adatta al
nodo di login, o se c’è un altro meccanismo per farlo in modo
sicuro.</p>
</div>
</div>
</div>
<p>È sempre possibile usare i comandi <code>top</code> e
<code>ps ux</code> per elencare i processi in esecuzione sul nodo di
accesso, insieme alla quantità di CPU e memoria che stanno utilizzando.
Se questo controllo rivela che il nodo di login è inattivo, si può
tranquillamente usarlo per le attività di elaborazione non routinarie.
Se qualcosa va storto (il processo impiega troppo tempo o non risponde),
si può usare il comando <code>kill</code> insieme al <em>PID</em> per
terminare il processo.</p>
<div id="galateo-del-nodo-di-accesso" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="galateo-del-nodo-di-accesso" class="callout-inner">
<h3 class="callout-title">Galateo del nodo di accesso</h3>
<div class="callout-content">
<p>Quale di questi comandi sarebbe un’operazione di routine da eseguire
sul nodo di login?</p>
<ol style="list-style-type: decimal">
<li><code>python physics_sim.py</code></li>
<li><code>make</code></li>
<li><code>create_directories.sh</code></li>
<li><code>molecular_dynamics_2</code></li>
<li><code>tar -xzf R-3.3.0.tar.gz</code></li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Soluzione
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>La creazione di software, la creazione di directory e il
disimballaggio di software sono compiti comuni e accettabili per il nodo
di login: le opzioni #2 (<code>make</code>), #3 (<code>mkdir</code>) e
#5 (<code>tar</code>) probabilmente vanno bene. Si noti che i nomi degli
script non sempre riflettono il loro contenuto: prima di lanciare il #3,
si consiglia di usare <code>less create_directories.sh</code> e
assicurarsi che non sia un cavallo di Troia.</p>
<p>L’esecuzione di applicazioni ad alta intensità di risorse è
sconsigliata. A meno che non siate sicuri che non influisca sugli altri
utenti, non eseguite lavori come il #1 (<code>python</code>) o il #4
(codice MD personalizzato). Se non si è sicuri, chiedere consiglio al
proprio sysadmin.</p>
</div>
</div>
</div>
</div>
<p>Se si riscontrano problemi di prestazioni con un nodo di login, è
necessario segnalarlo al personale del sistema (di solito tramite
l’helpdesk) affinché indaghi.</p>
</section><section><h2 class="section-heading" id="test-prima-di-scalare">Test prima di scalare<a class="anchor" aria-label="anchor" href="#test-prima-di-scalare"></a>
</h2>
<hr class="half-width">
<p>Ricordate che in genere l’utilizzo dei sistemi condivisi viene
addebitato. Un semplice errore in uno script di lavoro può finire per
costare una grande quantità di budget di risorse. Immaginate uno script
di lavoro con un errore che lo fa stare fermo per 24 ore su 1000 core o
uno in cui avete richiesto per errore 2000 core e ne usate solo 100!
Questo problema può essere aggravato quando si scrivono script che
automatizzano l’invio di lavori (ad esempio, quando si esegue lo stesso
calcolo o analisi su molti parametri o file diversi). Quando ciò accade,
si danneggia sia l’utente (che spreca molte risorse caricate) sia gli
altri utenti (che sono bloccati dall’accesso ai nodi di calcolo
inattivi). Su risorse molto trafficate, potreste aspettare molti giorni
in coda e il vostro lavoro potrebbe fallire entro 10 secondi dall’avvio
a causa di un banale errore di battitura nello script del lavoro. Questo
è estremamente frustrante!</p>
<p>La maggior parte dei sistemi fornisce risorse dedicate ai test con
tempi di attesa brevi per evitare questo problema.</p>
<div id="test-degli-script-di-invio-dei-lavori-che-utilizzano-grandi-quantità-di-risorse" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="test-degli-script-di-invio-dei-lavori-che-utilizzano-grandi-quantità-di-risorse" class="callout-inner">
<h3 class="callout-title">Test degli script di invio dei lavori che utilizzano grandi quantità di risorse</h3>
<div class="callout-content">
<p>Prima di inviare un’ampia serie di lavori, inviarne uno come test per
assicurarsi che tutto funzioni come previsto.</p>
<p>Prima di inviare un lavoro molto grande o molto lungo, eseguire un
breve test troncato per assicurarsi che il lavoro venga avviato come
previsto.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="avere-un-piano-di-backup">Avere un piano di backup<a class="anchor" aria-label="anchor" href="#avere-un-piano-di-backup"></a>
</h2>
<hr class="half-width">
<p>Sebbene molti sistemi HPC mantengano dei backup, questi non sempre
coprono tutti i file system disponibili e possono servire solo per scopi
di disaster recovery (cioè per ripristinare l’intero file system in caso
di perdita piuttosto che un singolo file o una directory cancellati per
errore). Proteggere i dati critici dalla corruzione o dall’eliminazione
è una responsabilità primaria dell’utente: conservare le proprie copie
di backup.</p>
<p>I sistemi di controllo delle versioni (come Git) hanno spesso offerte
gratuite basate su cloud (ad esempio, GitHub e GitLab) che vengono
generalmente utilizzate per archiviare il codice sorgente. Anche se non
si scrivono programmi propri, questi sistemi possono essere molto utili
per archiviare script di lavoro, script di analisi e piccoli file di
input.</p>
<p>Se state costruendo un software, potreste avere una grande quantità
di codice sorgente che compilate per creare il vostro eseguibile. Poiché
questi dati possono essere generalmente recuperati scaricando nuovamente
il codice o eseguendo nuovamente l’operazione di checkout dal repository
del codice sorgente, questi dati sono anche meno critici da
proteggere.</p>
<p>Per le grandi quantità di dati, in particolare per i risultati
importanti delle esecuzioni, che possono essere insostituibili, è
necessario assicurarsi di disporre di un sistema robusto per prelevare
le copie dei dati dal sistema HPC, ove possibile, e trasferirle su uno
storage di backup. Strumenti come <code>rsync</code> possono essere
molto utili a questo scopo.</p>
<p>Il vostro accesso al sistema HPC condiviso sarà generalmente limitato
nel tempo, quindi dovreste assicurarvi di avere un piano per trasferire
i vostri dati dal sistema prima che il vostro accesso finisca. Il tempo
necessario per trasferire grandi quantità di dati non deve essere
sottovalutato e bisogna assicurarsi di averlo pianificato con
sufficiente anticipo (idealmente, prima ancora di iniziare a usare il
sistema per la propria ricerca).</p>
<p>In tutti questi casi, l’helpdesk del sistema in uso dovrebbe essere
in grado di fornire indicazioni utili sulle opzioni di trasferimento dei
dati per i volumi di dati da utilizzare.</p>
<div id="i-vostri-dati-sono-sotto-la-vostra-responsabilità" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="i-vostri-dati-sono-sotto-la-vostra-responsabilità" class="callout-inner">
<h3 class="callout-title">I vostri dati sono sotto la vostra responsabilità</h3>
<div class="callout-content">
<p>Assicuratevi di aver capito qual è la politica di backup sui file
system del sistema che state usando e quali sono le implicazioni per il
vostro lavoro se perdete i vostri dati sul sistema. Pianificate i backup
dei dati critici e le modalità di trasferimento dei dati dal sistema
durante il progetto.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="trasferimento-dei-dati">Trasferimento dei dati<a class="anchor" aria-label="anchor" href="#trasferimento-dei-dati"></a>
</h2>
<hr class="half-width">
<p>Come accennato in precedenza, molti utenti si trovano prima o poi a
dover trasferire grandi quantità di dati dai sistemi HPC (è più
frequente il caso di trasferimento di dati da un sistema all’altro che
da un sistema all’altro, ma i consigli che seguono si applicano in
entrambi i casi). La velocità di trasferimento dei dati può essere
limitata da molti fattori diversi, quindi il miglior meccanismo di
trasferimento dei dati da utilizzare dipende dal tipo di dati da
trasferire e dalla loro destinazione.</p>
<p>I componenti tra la sorgente e la destinazione dei dati hanno livelli
di prestazioni variabili e, in particolare, possono avere capacità
diverse in termini di <strong>larghezza di banda</strong> e
<strong>latenza</strong>.</p>
<p>La <strong>larghezza di banda</strong> è generalmente la quantità
grezza di dati per unità di tempo che un dispositivo è in grado di
trasmettere o ricevere. È una metrica comune e generalmente ben
compresa.</p>
<p>La <strong>latenza</strong> è un po’ più sottile. Per i trasferimenti
di dati, si può pensare che sia la quantità di tempo necessaria per far
uscire i dati dalla memoria e portarli in una forma trasmissibile. I
problemi di latenza sono il motivo per cui è consigliabile eseguire i
trasferimenti di dati spostando un piccolo numero di file di grandi
dimensioni, piuttosto che il contrario.</p>
<p>Alcuni dei componenti chiave e dei problemi ad essi associati
sono:</p>
<ul>
<li>
<strong>Velocità del disco</strong>: I file system dei sistemi HPC
sono spesso altamente paralleli, costituiti da un numero molto elevato
di unità disco ad alte prestazioni. Ciò consente loro di supportare una
larghezza di banda dei dati molto elevata. A meno che il sistema remoto
non abbia un file system parallelo simile, la velocità di trasferimento
potrebbe essere limitata dalle prestazioni del disco.</li>
<li>
<strong>Prestazioni dei metadati</strong>: <em>Le operazioni sui
meta-dati</em>, come l’apertura e la chiusura dei file o l’elenco del
proprietario o delle dimensioni di un file, sono molto meno parallele
delle operazioni di lettura/scrittura. Se i dati sono costituiti da un
numero molto elevato di piccoli file, la velocità di trasferimento
potrebbe essere limitata dalle operazioni sui meta-dati. Anche le
operazioni sui meta-dati eseguite da altri utenti del sistema possono
interagire fortemente con quelle eseguite dall’utente, per cui la
riduzione del numero di tali operazioni (combinando più file in un unico
file) può ridurre la variabilità della velocità di trasferimento e
aumentarla.</li>
<li>
<strong>Velocità della rete</strong>: Le prestazioni di
trasferimento dei dati possono essere limitate dalla velocità della
rete. Soprattutto è limitata dalla sezione più lenta della rete tra la
sorgente e la destinazione. Se si sta trasferendo al proprio
portatile/alla propria postazione di lavoro, è probabile che si tratti
della sua connessione (via LAN o WiFi).</li>
<li>
<strong>Velocità del firewall</strong>: La maggior parte delle reti
moderne è protetta da una qualche forma di firewall che filtra il
traffico dannoso. Questo filtraggio ha un certo overhead e può
comportare una riduzione delle prestazioni di trasferimento dei dati. Le
esigenze di una rete generica che ospita e-mail/web-server e computer
desktop sono molto diverse da quelle di una rete di ricerca che deve
supportare un elevato volume di trasferimenti di dati. Se si cerca di
trasferire dati da o verso un host su una rete generica, è possibile che
il firewall di quella rete limiti la velocità di trasferimento.</li>
</ul>
<p>Come già detto, se si dispone di dati correlati che consistono in un
gran numero di piccoli file, si consiglia vivamente di impacchettare i
file in un file <em>archivio</em> più grande per l’archiviazione e il
trasferimento a lungo termine. Un singolo file di grandi dimensioni
consente di utilizzare in modo più efficiente il file system ed è più
facile da spostare, copiare e trasferire perché sono necessarie molte
meno operazioni sui metadati. I file di archivio possono essere creati
con strumenti come <code>tar</code> e <code>zip</code>. Abbiamo già
incontrato <code>tar</code> quando abbiamo parlato del trasferimento dei
dati.</p>
<figure><img src="../fig/responsibility-bandwidth.svg" max-width="90%" alt="Schema della larghezza di banda di rete" class="figure mx-auto d-block"><div class="figcaption">Diagramma schematico della larghezza di banda e
della latenza per l’I/O su disco e di rete. Ogni componente della figura
è collegato da una linea blu di larghezza proporzionale alla larghezza
di banda dell’interfaccia. I piccoli labirinti in corrispondenza dei
punti di collegamento illustrano la latenza del collegamento, con
labirinti più tortuosi che indicano una latenza più elevata.</div>
</figure><div id="considerare-il-modo-migliore-per-trasferire-i-dati" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="considerare-il-modo-migliore-per-trasferire-i-dati" class="callout-inner">
<h3 class="callout-title">Considerare il modo migliore per trasferire i dati</h3>
<div class="callout-content">
<p>Se si trasferiscono grandi quantità di dati, è necessario pensare a
cosa può influire sulle prestazioni del trasferimento. È sempre utile
eseguire alcuni test da utilizzare per estrapolare il tempo necessario
per trasferire i dati.</p>
<p>Supponiamo di avere una cartella “dati” contenente circa 10.000 file,
un sano mix di dati ASCII e binari di piccole e grandi dimensioni. Quale
dei seguenti è il modo migliore per trasferirli in HPC Carpentry’s Cloud
Cluster?</p>
<ol style="list-style-type: decimal">
<li><p><code>scp -r data yourUsername@cluster.hpc-carpentry.org:~/</code></p></li>
<li><p><code>rsync -ra data yourUsername@cluster.hpc-carpentry.org:~/</code></p></li>
<li><p><code>rsync -raz data yourUsername@cluster.hpc-carpentry.org:~/</code></p></li>
<li>
<p><code>tar -cvf data.tar data;</code></p>
<p><code>rsync -raz data.tar yourUsername@cluster.hpc-carpentry.org:~/</code></p>
</li>
<li>
<p><code>tar -cvzf data.tar.gz data;</code></p>
<p><code>rsync -ra data.tar.gz yourUsername@cluster.hpc-carpentry.org:~/</code></p>
</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  Soluzione
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<ol style="list-style-type: decimal">
<li>
<code>scp</code> copierà ricorsivamente la directory. Funziona, ma
senza compressione.</li>
<li>
<code>rsync -ra</code> funziona come <code>scp -r</code>, ma
conserva le informazioni sui file, come i tempi di creazione. Questo è
marginalmente migliore.</li>
<li>
<code>rsync -raz</code> aggiunge la compressione, che farà
risparmiare un po’ di larghezza di banda. Se si dispone di una CPU forte
a entrambi i capi della linea e si è su una rete lenta, questa è una
buona scelta.</li>
<li>Questo comando usa prima <code>tar</code> per unire tutto in un
unico file, poi <code>rsync -z</code> per trasferirlo con la
compressione. Con un numero così elevato di file, l’overhead dei
metadati può ostacolare il trasferimento, quindi questa è una buona
idea.</li>
<li>Questo comando usa <code>tar -z</code> per comprimere l’archivio e
poi <code>rsync</code> per trasferirlo. Le prestazioni sono simili a
quelle del comando #4, ma nella maggior parte dei casi (per insiemi di
dati di grandi dimensioni), è la migliore combinazione di alta velocità
e bassa latenza (per sfruttare al meglio il tempo e la connessione di
rete).</li>
</ol>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Fare attenzione a come si usa il nodo login.</li>
<li>I dati presenti sul sistema sono sotto la propria
responsabilità.</li>
<li>Pianificare e testare trasferimenti di dati di grandi
dimensioni.</li>
<li>Spesso è meglio convertire molti file in un singolo file di archivio
prima di trasferirli.</li>
</ul>
</div>
</div>
</div>
</section></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/ocaisa/probable-pancake/edit/main/README.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/ocaisa/probable-pancake/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/ocaisa/probable-pancake/" class="external-link">Source</a></p>
				<p><a href="https://github.com/ocaisa/probable-pancake/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:team@carpentries.org">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.11" class="external-link">sandpaper (0.16.11)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.9" class="external-link">pegboard (0.7.9)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.5" class="external-link">varnish (1.0.5)</a></p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://ocaisa.github.io/probable_pancake/instructor/aio.html",
  "inLanguage": "it",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://ocaisa.github.io/probable_pancake/instructor/aio.html",
  "identifier": "https://ocaisa.github.io/probable_pancake/instructor/aio.html",
  "dateCreated": "2017-03-24",
  "dateModified": "2025-03-23",
  "datePublished": "2025-03-23"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo --><script>
          var _paq = window._paq = window._paq || [];
          /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
          _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
          _paq.push(["setDomains", ["*.lessons.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
          _paq.push(["setDoNotTrack", true]);
          _paq.push(["disableCookies"]);
          _paq.push(["trackPageView"]);
          _paq.push(["enableLinkTracking"]);
          (function() {
              var u="https://matomo.carpentries.org/";
              _paq.push(["setTrackerUrl", u+"matomo.php"]);
              _paq.push(["setSiteId", "1"]);
              var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0];
              g.async=true; g.src="https://matomo.carpentries.org/matomo.js"; s.parentNode.insertBefore(g,s);
          })();
        </script><!-- End Matomo Code -->
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

